<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>9.8&nbsp;Backtracking</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span style="font-weight: bold">Guide</span>:<span class="mywbr"> </span> Racket</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" pltdoc="x">Welcome to Racket</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="to-scheme.html" class="tocviewlink" pltdoc="x">Racket Essentials</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="datatypes.html" class="tocviewlink" pltdoc="x">Built-<wbr></wbr>In Datatypes</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="scheme-forms.html" class="tocviewlink" pltdoc="x">Expressions and Definitions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="define-struct.html" class="tocviewlink" pltdoc="x">Programmer-<wbr></wbr>Defined Datatypes</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="modules.html" class="tocviewlink" pltdoc="x">Modules</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="contracts.html" class="tocviewlink" pltdoc="x">Contracts</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="i_o.html" class="tocviewlink" pltdoc="x">Input and Output</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="regexp.html" class="tocviewselflink" pltdoc="x">Regular Expressions</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="control.html" class="tocviewlink" pltdoc="x">Exceptions and Control</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="for.html" class="tocviewlink" pltdoc="x">Iterations and Comprehensions</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="match.html" class="tocviewlink" pltdoc="x">Pattern Matching</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="classes.html" class="tocviewlink" pltdoc="x">Classes and Objects</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="units.html" class="tocviewlink" pltdoc="x">Units (Components)</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="reflection.html" class="tocviewlink" pltdoc="x">Reflection and Dynamic Evaluation</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="macros.html" class="tocviewlink" pltdoc="x">Macros</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="languages.html" class="tocviewlink" pltdoc="x">Creating Languages</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="performance.html" class="tocviewlink" pltdoc="x">Performance</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="running.html" class="tocviewlink" pltdoc="x">Running and Creating Executables</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="compile.html" class="tocviewlink" pltdoc="x">Compilation and Configuration</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="More_Libraries.html" class="tocviewlink" pltdoc="x">More Libraries</a></td></tr><tr><td align="right">22&nbsp;</td><td><a href="dialects.html" class="tocviewlink" pltdoc="x">Dialects of Racket and Scheme</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>9&nbsp;</td><td><a href="regexp.html" class="tocviewlink" pltdoc="x">Regular Expressions</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">9.1&nbsp;</td><td><a href="regexp-intro.html" class="tocviewlink" pltdoc="x">Writing Regexp Patterns</a></td></tr><tr><td align="right">9.2&nbsp;</td><td><a href="regexp-match.html" class="tocviewlink" pltdoc="x">Matching Regexp Patterns</a></td></tr><tr><td align="right">9.3&nbsp;</td><td><a href="regexp-assert.html" class="tocviewlink" pltdoc="x">Basic Assertions</a></td></tr><tr><td align="right">9.4&nbsp;</td><td><a href="regexp-chars.html" class="tocviewlink" pltdoc="x">Characters and Character Classes</a></td></tr><tr><td align="right">9.5&nbsp;</td><td><a href="regexp-quant.html" class="tocviewlink" pltdoc="x">Quantifiers</a></td></tr><tr><td align="right">9.6&nbsp;</td><td><a href="regexp-clusters.html" class="tocviewlink" pltdoc="x">Clusters</a></td></tr><tr><td align="right">9.7&nbsp;</td><td><a href="regexp-alternation.html" class="tocviewlink" pltdoc="x">Alternation</a></td></tr><tr><td align="right">9.8&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Backtracking</a></td></tr><tr><td align="right">9.9&nbsp;</td><td><a href="Looking_Ahead_and_Behind.html" class="tocviewlink" pltdoc="x">Looking Ahead and Behind</a></td></tr><tr><td align="right">9.10&nbsp;</td><td><a href="An_Extended_Example.html" class="tocviewlink" pltdoc="x">An Extended Example</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="regexp-alternation.html" title="backward to &quot;9.7 Alternation&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="regexp.html" title="up to &quot;9 Regular Expressions&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="Looking_Ahead_and_Behind.html" title="forward to &quot;9.9 Looking Ahead and Behind&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>9.8<tt>&nbsp;</tt><a name="(part._.Backtracking)"></a>Backtracking</h4><p>We&rsquo;ve already seen that greedy quantifiers match the maximal number of
times, but the overriding priority is that the overall match succeed.
Consider</p><p><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/regexp.html#(def._((quote._~23~25kernel)._regexp-match))" class="RktValLink" pltdoc="x">regexp-match</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#rx"a*a"</span><span class="hspace">&nbsp;</span><span class="RktVal">"aaaa"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">'("aaaa")</span></p></td></tr></table></p><p>The regexp consists of two subregexps: <span class="RktInBG"><span class="hspace"></span><span class="RktIn">a*</span><span class="hspace"></span></span> followed by
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">a</span><span class="hspace"></span></span>.  The subregexp <span class="RktInBG"><span class="hspace"></span><span class="RktIn">a*</span><span class="hspace"></span></span> cannot be allowed to match
all four <span class="RktInBG"><span class="hspace"></span><span class="RktIn">a</span><span class="hspace"></span></span>&rsquo;s in the text string <span class="RktSym">aaaa</span>, even though
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">*</span><span class="hspace"></span></span> is a greedy quantifier.  It may match only the first
three, leaving the last one for the second subregexp.  This ensures
that the full regexp matches successfully.</p><p>The regexp matcher accomplishes this via a process called
<a name="(tech._backtracking)"></a><span style="font-style: italic">backtracking</span>.  The matcher tentatively allows the greedy
quantifier to match all four <span class="RktInBG"><span class="hspace"></span><span class="RktIn">a</span><span class="hspace"></span></span>&rsquo;s, but then when it becomes
clear that the overall match is in jeopardy, it <span style="font-style: italic">backtracks</span> to a
less greedy match of three <span class="RktInBG"><span class="hspace"></span><span class="RktIn">a</span><span class="hspace"></span></span>&rsquo;s.  If even this fails, as in
the call</p><p><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/regexp.html#(def._((quote._~23~25kernel)._regexp-match))" class="RktValLink" pltdoc="x">regexp-match</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#rx"a*aa"</span><span class="hspace">&nbsp;</span><span class="RktVal">"aaaa"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">'("aaaa")</span></p></td></tr></table></p><p>the matcher backtracks even further.  Overall failure is conceded
only when all possible backtracking has been tried with no success.</p><p>Backtracking is not restricted to greedy quantifiers.
Nongreedy quantifiers match as few instances as
possible, and progressively backtrack to more and more
instances in order to attain an overall match.  There
is backtracking in alternation too, as the more
rightward alternates are tried when locally successful
leftward ones fail to yield an overall match.</p><p>Sometimes it is efficient to disable backtracking.  For example, we
may wish to commit to a choice, or we know that trying alternatives is
fruitless.  A nonbacktracking regexp is enclosed in
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">(?&gt;</span><span class="hspace"></span></span>...<span class="RktInBG"><span class="hspace"></span><span class="RktIn">)</span><span class="hspace"></span></span>.</p><p><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/regexp.html#(def._((quote._~23~25kernel)._regexp-match))" class="RktValLink" pltdoc="x">regexp-match</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#rx"(?&gt;a+)."</span><span class="hspace">&nbsp;</span><span class="RktVal">"aaaa"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#f</span></p></td></tr></table></p><p>In this call, the subregexp <span class="RktInBG"><span class="hspace"></span><span class="RktIn">?&gt;a+</span><span class="hspace"></span></span> greedily matches all four
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">a</span><span class="hspace"></span></span>&rsquo;s, and is denied the opportunity to backtrack.  So, the
overall match is denied.  The effect of the regexp is therefore to
match one or more <span class="RktInBG"><span class="hspace"></span><span class="RktIn">a</span><span class="hspace"></span></span>&rsquo;s followed by something that is
definitely non-<span class="RktInBG"><span class="hspace"></span><span class="RktIn">a</span><span class="hspace"></span></span>.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="regexp-alternation.html" title="backward to &quot;9.7 Alternation&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="regexp.html" title="up to &quot;9 Regular Expressions&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="Looking_Ahead_and_Behind.html" title="forward to &quot;9.9 Looking Ahead and Behind&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>