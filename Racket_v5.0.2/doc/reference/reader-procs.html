<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>12.9.2&nbsp;Reader-Extension Procedures</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="extras.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span style="font-weight: bold">Reference</span>:<span class="mywbr"> </span> Racket</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="model.html" class="tocviewlink" pltdoc="x">Language Model</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="syntax.html" class="tocviewlink" pltdoc="x">Syntactic Forms</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="data.html" class="tocviewlink" pltdoc="x">Datatypes</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="structures.html" class="tocviewlink" pltdoc="x">Structures</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="mzlib_class.html" class="tocviewlink" pltdoc="x">Classes and Objects</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="mzlib_unit.html" class="tocviewlink" pltdoc="x">Units</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="contracts.html" class="tocviewlink" pltdoc="x">Contracts</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="match.html" class="tocviewlink" pltdoc="x">Pattern Matching</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="control.html" class="tocviewlink" pltdoc="x">Control Flow</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="concurrency.html" class="tocviewlink" pltdoc="x">Concurrency</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Macros.html" class="tocviewlink" pltdoc="x">Macros</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="input-and-output.html" class="tocviewselflink" pltdoc="x">Input and Output</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="security.html" class="tocviewlink" pltdoc="x">Reflection and Security</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="os.html" class="tocviewlink" pltdoc="x">Operating System</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="memory.html" class="tocviewlink" pltdoc="x">Memory Management</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="unsafe.html" class="tocviewlink" pltdoc="x">Unsafe Operations</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="running.html" class="tocviewlink" pltdoc="x">Running Racket</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>12&nbsp;</td><td><a href="input-and-output.html" class="tocviewlink" pltdoc="x">Input and Output</a></td></tr></table><div class="tocviewsublist" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">12.1&nbsp;</td><td><a href="ports.html" class="tocviewlink" pltdoc="x">Ports</a></td></tr><tr><td align="right">12.2&nbsp;</td><td><a href="Byte_and_String_Input.html" class="tocviewlink" pltdoc="x">Byte and String Input</a></td></tr><tr><td align="right">12.3&nbsp;</td><td><a href="Byte_and_String_Output.html" class="tocviewlink" pltdoc="x">Byte and String Output</a></td></tr><tr><td align="right">12.4&nbsp;</td><td><a href="Reading.html" class="tocviewlink" pltdoc="x">Reading</a></td></tr><tr><td align="right">12.5&nbsp;</td><td><a href="Writing.html" class="tocviewlink" pltdoc="x">Writing</a></td></tr><tr><td align="right">12.6&nbsp;</td><td><a href="reader.html" class="tocviewlink" pltdoc="x">The Reader</a></td></tr><tr><td align="right">12.7&nbsp;</td><td><a href="printing.html" class="tocviewlink" pltdoc="x">The Printer</a></td></tr><tr><td align="right">12.8&nbsp;</td><td><a href="pretty-print.html" class="tocviewlink" pltdoc="x">Pretty Printing</a></td></tr><tr><td align="right">12.9&nbsp;</td><td><a href="Reader_Extension.html" class="tocviewselflink" pltdoc="x">Reader Extension</a></td></tr><tr><td align="right">12.10&nbsp;</td><td><a href="Printer_Extension.html" class="tocviewlink" pltdoc="x">Printer Extension</a></td></tr><tr><td align="right">12.11&nbsp;</td><td><a href="serialization.html" class="tocviewlink" pltdoc="x">Serialization</a></td></tr><tr><td align="right">12.12&nbsp;</td><td><a href="fasl.html" class="tocviewlink" pltdoc="x">Fast-<wbr></wbr>Load Serialization</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9660;</a></td><td>12.9&nbsp;</td><td><a href="Reader_Extension.html" class="tocviewlink" pltdoc="x">Reader Extension</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">12.9.1&nbsp;</td><td><a href="readtables.html" class="tocviewlink" pltdoc="x">Readtables</a></td></tr><tr><td align="right">12.9.2&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Reader-<wbr></wbr>Extension Procedures</a></td></tr><tr><td align="right">12.9.3&nbsp;</td><td><a href="special-comments.html" class="tocviewlink" pltdoc="x">Special Comments</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="readtables.html" title="backward to &quot;12.9.1 Readtables&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Reader_Extension.html" title="up to &quot;12.9 Reader Extension&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="special-comments.html" title="forward to &quot;12.9.3 Special Comments&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h5>12.9.2<tt>&nbsp;</tt><a name="(part._reader-procs)"></a>Reader-Extension Procedures</h5><p>Calls to <a href="Reader_Extension.html#(tech._reader._extension._procedure)" pltdoc="x">reader extension procedures</a> can be triggered
through <span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read))" class="RktValLink" pltdoc="x">read</a></span>, <span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read/recursive))" class="RktValLink" pltdoc="x">read/recursive</a></span>, <span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="RktValLink" pltdoc="x">read-syntax</a></span>,
or <span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read-honu-syntax))" class="RktValLink" pltdoc="x">read-honu-syntax</a></span>. In addition, a special-read procedure
can be triggered by calls to <span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read-honu))" class="RktValLink" pltdoc="x">read-honu</a></span>,
<span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read-honu/recursive))" class="RktValLink" pltdoc="x">read-honu/recursive</a></span>, <span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read-honu-syntax))" class="RktValLink" pltdoc="x">read-honu-syntax</a></span>,
<span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read-honu-syntax/recursive))" class="RktValLink" pltdoc="x">read-honu-syntax/recursive</a></span>, <span class="RktSym"><a href="Byte_and_String_Input.html#(def._((quote._~23~25kernel)._read-char-or-special))" class="RktValLink" pltdoc="x">read-char-or-special</a></span>, or
by the context of <span class="RktSym"><a href="Byte_and_String_Input.html#(def._((quote._~23~25kernel)._read-bytes-avail!))" class="RktValLink" pltdoc="x">read-bytes-avail!</a></span>,
<span class="RktSym"><a href="Byte_and_String_Input.html#(def._((quote._~23~25kernel)._read-bytes-avail!*))" class="RktValLink" pltdoc="x">read-bytes-avail!*</a></span>, <span class="RktSym"><a href="Byte_and_String_Input.html#(def._((quote._~23~25kernel)._read-bytes-avail!))" class="RktValLink" pltdoc="x">read-bytes-avail!</a></span>, and
<span class="RktSym"><a href="Byte_and_String_Input.html#(def._((quote._~23~25kernel)._peek-bytes-avail!*))" class="RktValLink" pltdoc="x">peek-bytes-avail!*</a></span>.</p><p>Optional arities for reader-macro and special-result procedures allow
them to distinguish reads via <span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read))" class="RktValLink" pltdoc="x">read</a></span>, etc. from reads via
<span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="RktValLink" pltdoc="x">read-syntax</a></span>, etc. (where the source value is <span class="RktVal">#f</span> and
no other location information is available).</p><p>When a reader-extension procedure is called in syntax-reading mode
(via <span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="RktValLink" pltdoc="x">read-syntax</a></span>, etc.), it should generally return a syntax
object that has no lexical context (e.g., a syntax object created
using <span class="RktSym"><a href="stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="RktValLink" pltdoc="x">datum-&gt;syntax</a></span> with <span class="RktVal">#f</span> as the first
argument and with the given location information as the third
argument). Another possible result is a special-comment value (see
<a href="special-comments.html" pltdoc="x">Special Comments</a>). If the procedure&rsquo;s result is not a
syntax object and not a special-comment value, it is converted to one
using <span class="RktSym"><a href="stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="RktValLink" pltdoc="x">datum-&gt;syntax</a></span>.</p><p>When a reader-extension procedure is called in non-syntax-reading
modes, it should generally not return a syntax object. If a syntax
object is returned, it is converted to a plain value using
<span class="RktSym">syntax-object-&gt;datum</span>.</p><p>In either context, when the result from a reader-extension procedure
is a special-comment value (see <a href="special-comments.html" pltdoc="x">Special Comments</a>), then
<span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read))" class="RktValLink" pltdoc="x">read</a></span>, <span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="RktValLink" pltdoc="x">read-syntax</a></span>, etc. treat the value as a
delimiting comment and otherwise ignore it.</p><p>Also, in either context, the result may be copied to prevent mutation
to vectors or boxes before the read result is completed, and to
support the construction of graphs with cycles. Mutable boxes,
vectors, and <a href="structures.html#(tech._prefab)" class="techoutside" pltdoc="x"><span class="techinside">prefab</span></a> structures are copied, along with any
pairs, boxes, vectors, pre prefab structures that lead to such mutable
values, to placeholders produced by a recursive read (see
<span class="RktSym"><a href="Reading.html#(def._((quote._~23~25kernel)._read/recursive))" class="RktValLink" pltdoc="x">read/recursive</a></span>), or to references of a shared value. Graph
structure (including cycles) is preserved in the copy.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="readtables.html" title="backward to &quot;12.9.1 Readtables&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Reader_Extension.html" title="up to &quot;12.9 Reader Extension&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="special-comments.html" title="forward to &quot;12.9.3 Special Comments&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>