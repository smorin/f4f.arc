<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>8.1&nbsp;Introduction</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span style="font-weight: bold">Syntax</span>:<span class="mywbr"> </span> Meta-<wbr></wbr>Programming Helpers</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="syntax-helpers.html" class="tocviewlink" pltdoc="x">Syntax Object Helpers</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="module-helpers.html" class="tocviewlink" pltdoc="x">Module-<wbr></wbr>Processing Helpers</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="transformer-helpers.html" class="tocviewlink" pltdoc="x">Macro Transformer Helpers</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="reader-helpers.html" class="tocviewlink" pltdoc="x">Reader Helpers</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="toplevel.html" class="tocviewlink" pltdoc="x">Non-<wbr></wbr>Module Compilation And Expansion</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="trusted-xforms.html" class="tocviewlink" pltdoc="x">Trusting Standard Recertifying Transformers</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="docprovide.html" class="tocviewlink" pltdoc="x">Attaching Documentation to Exports</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="stxparse.html" class="tocviewselflink" pltdoc="x">Parsing and specifying syntax</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>8&nbsp;</td><td><a href="stxparse.html" class="tocviewlink" pltdoc="x">Parsing and specifying syntax</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">8.1&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Introduction</a></td></tr><tr><td align="right">8.2&nbsp;</td><td><a href="stxparse-examples.html" class="tocviewlink" pltdoc="x">Examples</a></td></tr><tr><td align="right">8.3&nbsp;</td><td><a href="Parsing_syntax.html" class="tocviewlink" pltdoc="x">Parsing syntax</a></td></tr><tr><td align="right">8.4&nbsp;</td><td><a href="stxparse-specifying.html" class="tocviewlink" pltdoc="x">Specifying syntax with syntax classes</a></td></tr><tr><td align="right">8.5&nbsp;</td><td><a href="stxparse-patterns.html" class="tocviewlink" pltdoc="x">Syntax patterns</a></td></tr><tr><td align="right">8.6&nbsp;</td><td><a href="Literal_sets_and_Conventions.html" class="tocviewlink" pltdoc="x">Literal sets and Conventions</a></td></tr><tr><td align="right">8.7&nbsp;</td><td><a href="Library_syntax_classes_and_literal_sets.html" class="tocviewlink" pltdoc="x">Library syntax classes and literal sets</a></td></tr><tr><td align="right">8.8&nbsp;</td><td><a href="Debugging_and_inspection_tools.html" class="tocviewlink" pltdoc="x">Debugging and inspection tools</a></td></tr><tr><td align="right">8.9&nbsp;</td><td><a href="Experimental.html" class="tocviewlink" pltdoc="x">Experimental</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="stxparse.html" title="backward to &quot;8 Parsing and specifying syntax&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="stxparse.html" title="up to &quot;8 Parsing and specifying syntax&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="stxparse-examples.html" title="forward to &quot;8.2 Examples&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>8.1<tt>&nbsp;</tt><a name="(part._stxparse-intro)"></a>Introduction</h4><p>This section provides an introduction to writing robust macros with
<span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> and syntax classes.</p><p>As a running example we use the following task: write a macro named
<span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span> that has the same syntax and behavior as Racket&rsquo;s
<span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span> form. The macro should produce good error messages when
used incorrectly.</p><p>Here is the specification of <span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span>&rsquo;s syntax:</p><blockquote class="leftindent"><table cellspacing="0" class="boxed"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))"></a><a name="(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))"></a><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">var-id</span><span class="hspace">&nbsp;</span><span class="RktVar">rhs-expr</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktVar">loop-id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">var-id</span><span class="hspace">&nbsp;</span><span class="RktVar">rhs-expr</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>For simplicity, we handle only the first case for now. We return to
the second case later in the introduction.</p><p>First, we import <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> into the <a href="../reference/syntax-model.html#(tech._transformer._environment)" class="techoutside" pltdoc="x"><span class="techinside">transformer environment</span></a>,
since we will use it to implement a macro transformer.</p><p><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._for-syntax))" class="RktStxLink" pltdoc="x">for-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktSym">syntax/parse</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></p><p>We get the first version of <span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span> by essentially
transliterating the syntax specification above. The result is similar
to what one would write using <span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._syntax-rules))" class="RktStxLink" pltdoc="x">syntax-rules</a></span> or perhaps
<span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._syntax-case))" class="RktStxLink" pltdoc="x">syntax-case</a></span>.</p><p><table cellspacing="0"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define-syntax))" class="RktStxLink" pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="RktStxLink" pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">var-id</span><span class="hspace">&nbsp;</span><span class="RktSym">rhs-expr</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var-id</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">rhs-expr</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></p><p>Note the use of <span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span> and <span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span> in the pattern;
<span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span> means match zero or more repetitions of the preceeding
pattern; <span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span> means match one or more. Only <span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span> may
be used in the template, however.</p><p><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">3</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="RktValLink" pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: bad syntax at: (mylet (b 2) (sub1 b))</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" class="RktValLink" pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">lambda: not an identifier, identifier with default, or</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">keyword at: 1</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">#:x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">struct eval:122:0: expects 0 arguments plus an argument</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">with keyword #:x, given 2: 1 2</span></p></td></tr></table></p><p>When used correctly, the macro works, but it behaves very badly in the
presence of errors. In some cases, <span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span> blithely accepts
illegal syntax and passes it along to <span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span>, with strange
consequences.</p><p>These examples of illegal syntax are not to suggest that a typical
programmer would make such mistakes attempting to use
<span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span>. At least, not often. After an initial learning
curve. But macros are also used by inexpert programmers and as targets
of other macros (or code generators), and many macros are far more
complex than <span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span>. Macros must validate their syntax and
report appropriate errors. Furthermore, the macro writer benefits from
the <span style="font-style: italic">machine-checked</span> specification of syntax in the form of more
readable, maintainable code.</p><p>The first step toward validation and high-quality error reporting is
annotating each of the macro&rsquo;s pattern variables with the <a href="stxparse-specifying.html#(tech._syntax._clas)" class="techoutside" pltdoc="x"><span class="techinside">syntax
class</span></a> that describes its acceptable syntax. In <span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span>, each
variable must be an <span class="RktSym"><a href="Library_syntax_classes_and_literal_sets.html#(form._((lib._syntax/parse..rkt)._identifier))" class="RktStxLink" pltdoc="x">identifier</a></span> (<span class="RktSym"><a href="Library_syntax_classes_and_literal_sets.html#(form._((lib._syntax/parse..rkt)._id))" class="RktStxLink" pltdoc="x">id</a></span> for short) and
each right-hand side must be an <span class="RktSym"><a href="Library_syntax_classes_and_literal_sets.html#(form._((lib._syntax/parse..rkt)._expr))" class="RktStxLink" pltdoc="x">expr</a></span> (expression). An
<a href="stxparse-patterns.html#(tech._annotated._pattern._variable)" class="techoutside" pltdoc="x"><span class="techinside">annotated pattern variable</span></a> is written by concatenating the
pattern variable name, a colon character, and the syntax class
name.<span class="refelem"><span class="refcolumn"><span class="refcontent">For an alternative to the &ldquo;colon&rdquo; syntax, see the
<span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._~7evar))" class="RktStxLink" pltdoc="x">~var</a></span> pattern form.</span></span></span></p><p><div class="SIntrapara"><table cellspacing="0"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define-syntax))" class="RktStxLink" pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="RktStxLink" pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">var:id</span><span class="hspace">&nbsp;</span><span class="RktSym">rhs:expr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></div><div class="SIntrapara">Note that the syntax class annotations do not appear in the template
(i.e., <span class="RktSym">var</span>, not <span class="RktSym">var:id</span>).</div></p><p><div class="SIntrapara">The syntax class annotations are checked when we use the macro.
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">3</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">"a"</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" class="RktValLink" pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected identifier at: "a"</span></p></td></tr></table></div><div class="SIntrapara">The <span class="RktSym"><a href="Library_syntax_classes_and_literal_sets.html#(form._((lib._syntax/parse..rkt)._expr))" class="RktStxLink" pltdoc="x">expr</a></span> syntax class does not actually check that the term
it matches is a valid expression &ndash; that would require calling that
macro expander. Instead, <span class="RktSym"><a href="Library_syntax_classes_and_literal_sets.html#(form._((lib._syntax/parse..rkt)._expr))" class="RktStxLink" pltdoc="x">expr</a></span> just means not a keyword.
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">#:whoops</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected expression at: #:whoops</span></p></td></tr></table></div><div class="SIntrapara">Also, <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> knows how to report a few kinds of errors
without any help:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: unexpected term at: 2</span></p></td></tr></table></div><div class="SIntrapara">There are other kinds of errors, however, that this macro does not
handle gracefully:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: bad syntax at: (mylet (a 1) (+ a 2))</span></p></td></tr></table></div><div class="SIntrapara">It&rsquo;s too much to ask for the macro to respond, &ldquo;This expression is
missing a pair of parentheses around <span class="RktPn">(</span><span class="RktSym">a</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span>.&rdquo; The pattern
matcher is not that smart. But it can pinpoint the source of the
error: when it encountered <span class="RktSym">a</span> it was expecting what we might
call a &ldquo;binding pair,&rdquo; but that term is not in its vocabulary yet.</div></p><p>To allow <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> to synthesize better errors, we must
attach <span style="font-style: italic">descriptions</span> to the patterns we recognize as discrete
syntactic categories. One way of doing that is by defining new syntax
classes:<span class="refelem"><span class="refcolumn"><span class="refcontent">Another way is the <span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._~7edescribe))" class="RktStxLink" pltdoc="x">~describe</a></span> pattern
form.</span></span></span></p><p><table cellspacing="0"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define-syntax))" class="RktStxLink" pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._define-syntax-class))" class="RktStxLink" pltdoc="x">define-syntax-class</a></span><span class="hspace">&nbsp;</span><span class="RktSym">binding</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"binding pair"</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._pattern))" class="RktStxLink" pltdoc="x">pattern</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var:id</span><span class="hspace">&nbsp;</span><span class="RktSym">rhs:expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="RktStxLink" pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b:binding</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">b.rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></p><p>Note that we write <span class="RktSym">b.var</span> and <span class="RktSym">b.rhs</span> now. They are the
<a href="stxparse-patterns.html#(tech._nested._attribute)" class="techoutside" pltdoc="x"><span class="techinside">nested attributes</span></a> formed from the annotated pattern variable
<span class="RktSym">b</span> and the attributes <span class="RktSym">var</span> and <span class="RktSym">rhs</span> of the
syntax class <span class="RktSym">binding</span>.</p><p><div class="SIntrapara">Now the error messages can talk about &ldquo;binding pairs.&rdquo;
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected binding pair at: a</span></p></td></tr></table></div><div class="SIntrapara">Errors are still reported in more specific terms when possible:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">"a"</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected identifier at: "a"</span></p></td></tr></table></div></p><p><div class="SIntrapara">There is one other constraint on the legal syntax of
<span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span>. The variables bound by the different binding pairs
must be distinct. Otherwise the macro creates an illegal
<span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span> form:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">lambda: duplicate argument name at: a</span></p></td></tr></table></div></p><p><div class="SIntrapara">Constraints such as the distinctness requirement are expressed as side
conditions, thus:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define-syntax))" class="RktStxLink" pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._define-syntax-class))" class="RktStxLink" pltdoc="x">define-syntax-class</a></span><span class="hspace">&nbsp;</span><span class="RktSym">binding</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"binding pair"</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._pattern))" class="RktStxLink" pltdoc="x">pattern</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var:id</span><span class="hspace">&nbsp;</span><span class="RktSym">rhs:expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="RktStxLink" pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b:binding</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:fail-when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stxcmp.html#(def._((lib._racket/private/stxcase-scheme..rkt)._check-duplicate-identifier))" class="RktValLink" pltdoc="x">check-duplicate-identifier</a></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stxops.html#(def._((quote._~23~25kernel)._syntax-~3elist))" class="RktValLink" pltdoc="x">syntax-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">b.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"duplicate variable name"</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">b.rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: duplicate variable name at: a</span></p></td></tr></table></div><div class="SIntrapara">The <span class="RktPn">#:fail-when</span> keyword is followed by two expressions: the
condition and the error message. When the condition evaluates to
anything but <span class="RktVal">#f</span>, the pattern fails. Additionally, if the
condition evaluates to a syntax object, that syntax object is used to
pinpoint the cause of the failure.</div></p><p><div class="SIntrapara">Syntax classes can have side conditions, too. Here is the macro
rewritten to include another syntax class representing a &ldquo;sequence of
distinct binding pairs.&rdquo;
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define-syntax))" class="RktStxLink" pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._define-syntax-class))" class="RktStxLink" pltdoc="x">define-syntax-class</a></span><span class="hspace">&nbsp;</span><span class="RktSym">binding</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"binding pair"</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._pattern))" class="RktStxLink" pltdoc="x">pattern</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var:id</span><span class="hspace">&nbsp;</span><span class="RktSym">rhs:expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._define-syntax-class))" class="RktStxLink" pltdoc="x">define-syntax-class</a></span><span class="hspace">&nbsp;</span><span class="RktSym">distinct-bindings</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"sequence of distinct binding pairs"</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._pattern))" class="RktStxLink" pltdoc="x">pattern</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b:binding</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:fail-when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stxcmp.html#(def._((lib._racket/private/stxcase-scheme..rkt)._check-duplicate-identifier))" class="RktValLink" pltdoc="x">check-duplicate-identifier</a></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stxops.html#(def._((quote._~23~25kernel)._syntax-~3elist))" class="RktValLink" pltdoc="x">syntax-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">b.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"duplicate variable name"</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:with</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">b.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:with</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">b.rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="RktStxLink" pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bs:distinct-bindings</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">body</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bs.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">body</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">bs.rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></div><div class="SIntrapara">Here we&rsquo;ve introduced the <span class="RktPn">#:with</span> clause. A <span class="RktPn">#:with</span>
clause matches a pattern with a computed term. Here we use it to bind
<span class="RktSym">var</span> and <span class="RktSym">rhs</span> as attributes of
<span class="RktSym">distinct-bindings</span>. By default, a syntax class only exports
its patterns&rsquo; pattern variables as attributes, not their nested
attributes.<span class="refelem"><span class="refcolumn"><span class="refcontent">The alternative would be to explicitly declare
the attributes of <span class="RktSym">distinct-bindings</span> to include the nested
attributes <span class="RktSym">b.var</span> and <span class="RktSym">b.rhs</span>, using the
<span class="RktPn">#:attribute</span> option. Then the macro would refer to
<span class="RktSym">bs.b.var</span> and <span class="RktSym">bs.b.rhs</span>.</span></span></span></div></p><p>Alas, so far the macro only implements half of the functionality
offered by Racket&rsquo;s <span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span>. We must add the
&ldquo;named-<span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span>&rdquo; form.  That turns out to be as simple as adding
a new clause:</p><p><div class="SIntrapara"><table cellspacing="0"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define-syntax))" class="RktStxLink" pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._define-syntax-class))" class="RktStxLink" pltdoc="x">define-syntax-class</a></span><span class="hspace">&nbsp;</span><span class="RktSym">binding</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"binding pair"</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._pattern))" class="RktStxLink" pltdoc="x">pattern</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var:id</span><span class="hspace">&nbsp;</span><span class="RktSym">rhs:expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._define-syntax-class))" class="RktStxLink" pltdoc="x">define-syntax-class</a></span><span class="hspace">&nbsp;</span><span class="RktSym">distinct-bindings</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"sequence of distinct binding pairs"</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="stxparse-specifying.html#(form._((lib._syntax/parse..rkt)._pattern))" class="RktStxLink" pltdoc="x">pattern</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b:binding</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:fail-when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stxcmp.html#(def._((lib._racket/private/stxcase-scheme..rkt)._check-duplicate-identifier))" class="RktValLink" pltdoc="x">check-duplicate-identifier</a></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stxops.html#(def._((quote._~23~25kernel)._syntax-~3elist))" class="RktValLink" pltdoc="x">syntax-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">b.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"duplicate variable name"</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:with</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">b.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:with</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">b.rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="RktStxLink" pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bs:distinct-bindings</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bs.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">bs.rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="RktStxLink" pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop:id</span><span class="hspace">&nbsp;</span><span class="RktSym">bs:distinct-bindings</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="stxparse-patterns.html#(form._((lib._syntax/parse..rkt)._......+))" class="RktStxLink" pltdoc="x">...+</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))" class="RktStxLink" pltdoc="x">letrec</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bs.var</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktSym">bs.rhs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></div><div class="SIntrapara">We are able to reuse the <span class="RktSym">distinct-bindings</span> syntax class, so
the addition of the &ldquo;named-<span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span>&rdquo; syntax requires only three
lines.</div></p><p><div class="SIntrapara">But does adding this new case affect <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span>&rsquo;s ability
to pinpoint and report errors?
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">3</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">"a"</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" class="RktValLink" pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected identifier at: "a"</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">#:whoops</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected expression at: #:whoops</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: unexpected term at: 2</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected binding pair at: a</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: duplicate variable name at: a</span></p></td></tr></table></div><div class="SIntrapara">The error reporting for the original syntax seems intact. We should
verify that the named-<span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span> syntax is working, that
<span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> is not simply ignoring that clause.
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">3</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">"a"</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" class="RktValLink" pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected identifier at: "a"</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">#:whoops</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected expression at: #:whoops</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="RktValLink" pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: unexpected term at: 2</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected binding pair at: a</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: duplicate variable name at: a</span></p></td></tr></table></div></p><p>How does <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> decide which clause the programmer was
attempting, so it can use it as a basis for error reporting? After
all, each of the bad uses of the named-<span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span> syntax are also
bad uses of the normal syntax, and vice versa. And yet the macro doen
not produce errors like &ldquo;<span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span>: expected sequence of
distinct binding pairs at: <span class="RktSym">loop</span>.&rdquo;</p><p>The answer is that <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> records a list of all the
potential errors (including ones like <span class="RktSym">loop</span> not matching
<span class="RktSym">distinct-binding</span>) along with the <span style="font-style: italic">progress</span> made before
each error. Only the error with the most progress is reported.</p><p><div class="SIntrapara">For example, in this bad use of the macro,
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">"a"</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" class="RktValLink" pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected identifier at: "a"</span></p></td></tr></table></div><div class="SIntrapara">there are two potential errors: expected <span class="RktSym">distinct-bindings</span> at
<span class="RktSym">loop</span> and expected <span class="RktSym"><a href="Library_syntax_classes_and_literal_sets.html#(form._((lib._syntax/parse..rkt)._identifier))" class="RktStxLink" pltdoc="x">identifier</a></span> at <span class="RktVal">"a"</span>. The
second error occurs further in the term than the first, so it is
reported.</div></p><p><div class="SIntrapara">For another example, consider this term:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">"a"</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" class="RktValLink" pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected identifier at: "a"</span></p></td></tr></table></div><div class="SIntrapara">Again, there are two potential errors: expected <span class="RktSym"><a href="Library_syntax_classes_and_literal_sets.html#(form._((lib._syntax/parse..rkt)._identifier))" class="RktStxLink" pltdoc="x">identifier</a></span> at
<span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">"a"</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">]</span><span class="RktPn">)</span> and expected <span class="RktSym"><a href="Library_syntax_classes_and_literal_sets.html#(form._((lib._syntax/parse..rkt)._identifier))" class="RktStxLink" pltdoc="x">identifier</a></span> at
<span class="RktVal">"a"</span>. They both occur at the second term (or first argument,
if you prefer), but the second error occurs deeper in the
term. Progress is based on a left-to-right traversal of the syntax.</div></p><p><div class="SIntrapara">A final example: consider the following:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: duplicate variable name at: a</span></p></td></tr></table></div><div class="SIntrapara">There are two errors again: duplicate variable name at <span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktSym">a</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span> and expected <span class="RktSym"><a href="Library_syntax_classes_and_literal_sets.html#(form._((lib._syntax/parse..rkt)._identifier))" class="RktStxLink" pltdoc="x">identifier</a></span> at <span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktSym">a</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">]</span><span class="RktPn">)</span>. Note that as far as <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> is concerned, the
progress associated with the duplicate error message is the second
term (first argument), not the second occurrence of <span class="RktSym">a</span>. That&rsquo;s
because the check is associated with the entire
<span class="RktSym">distinct-bindings</span> pattern. It would seem that both errors
have the same progress, and yet only the first one is reported. The
difference between the two is that the first error is from a
<span style="font-style: italic">post-traversal</span> check, whereas the second is from a normal
(i.e., pre-traversal) check. A post-traveral check is considered to
have made more progress than a pre-traversal check of the same term;
indeed, it also has greater progress than any failure <span style="font-style: italic">within</span>
the term.</div></p><p><div class="SIntrapara">It is, however, possible for multiple potential errors to occur with
the same progress. Here&rsquo;s one example:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"not-even-close"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: expected identifier or expected sequence of distinct</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">binding pairs at: "not-even-close"</span></p></td></tr></table></div><div class="SIntrapara">In this case <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> reports both errors.</div></p><p><div class="SIntrapara">Even with all of the annotations we have added to our macro, there are
still some misuses that defy <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span>&rsquo;s error reporting
capabilities, such as this example:
</div><div class="SIntrapara"><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">mylet: bad syntax at: (mylet)</span></p></td></tr></table></div><div class="SIntrapara">The philosophy behind <span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> is that in these
situations, a generic error such as &ldquo;bad syntax&rdquo; is justified. The
use of <span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span> here is so far off that the only informative
error message would include a complete recapitulation of the syntax of
<span class="RktSym"><a href="#(form._((lib._syntax/scribblings/parse/parse-dummy-bindings..rkt)._mylet))" class="RktStxLink" pltdoc="x">mylet</a></span>. That is not the role of error messages, however; it is
the role of documentation.</div></p><p>This section has provided an introduction to syntax classes, side
conditions, and progress-ordered error reporting. But
<span class="RktSym"><a href="Parsing_syntax.html#(form._((lib._syntax/parse..rkt)._syntax-parse))" class="RktStxLink" pltdoc="x">syntax-parse</a></span> has many more features. Continue to the
<a href="stxparse-examples.html" pltdoc="x">Examples</a> section for samples of other features in
working code, or skip to the subsequent sections for the complete
reference documentation.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="stxparse.html" title="backward to &quot;8 Parsing and specifying syntax&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="stxparse.html" title="up to &quot;8 Parsing and specifying syntax&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="stxparse-examples.html" title="forward to &quot;8.2 Examples&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>