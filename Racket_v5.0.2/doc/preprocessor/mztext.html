<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>3&nbsp;mztext</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span class="stt">mzpp</span> and <span class="stt">mztext</span>:<span class="mywbr"> </span> Preprocessors</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="mzpp.html" class="tocviewlink" pltdoc="x"><span class="stt">mzpp</span></a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x"><span class="stt">mztext</span></a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>3&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x"><span class="stt">mztext</span></a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="#(part._.Invoking_mztext)" class="tocviewlink" pltdoc="x">Invoking mztext</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="#(part._mztext_processing__the_standard_command_dispatcher)" class="tocviewlink" pltdoc="x">mztext processing:<span class="mywbr"> </span> the standard command dispatcher</a></td></tr><tr><td align="right">3.3&nbsp;</td><td><a href="#(part._mztext-lib)" class="tocviewlink" pltdoc="x">Provided bindings</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#(part._.Invoking_mztext)" class="tocsubseclink" pltdoc="x">Invoking mztext</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#(part._mztext_processing__the_standard_command_dispatcher)" class="tocsubseclink" pltdoc="x">mztext processing:<span class="mywbr"> </span> the standard command dispatcher</a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#(part._mztext-lib)" class="tocsubseclink" pltdoc="x">Provided bindings</a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._command-marker))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">command-<wbr></wbr>marker</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._dispatchers))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">dispatchers</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._make-composite-input))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>composite-<wbr></wbr>input</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._add-to-input))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">add-<wbr></wbr>to-<wbr></wbr>input</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._paren-pairs))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">paren-<wbr></wbr>pairs</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg-reads-word~3f))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">get-<wbr></wbr>arg-<wbr></wbr>reads-<wbr></wbr>word?</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">get-<wbr></wbr>arg</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg*))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">get-<wbr></wbr>arg*</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._swallow-newline))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">swallow-<wbr></wbr>newline</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._defcommand))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">defcommand</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._include))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">include</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._preprocess))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">preprocess</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._stdin))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">stdin</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._stdout))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">stdout</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._stderr))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">stderr</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._cd))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">cd</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._preprocessor/mztext..rkt)._current-file))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: preprocessor/mztext"><span class="RktSym"><span class="RktValLink">current-<wbr></wbr>file</span></span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="mzpp.html" title="backward to &quot;2 mzpp&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;mzpp and mztext: Preprocessors&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h3>3<tt>&nbsp;</tt><a name="(part._mztext)"></a><span class="stt">mztext</span></h3><p><span class="stt">mztext</span> is another Scheme-based preprocessing language.  It can
be used as a preprocessor in a similar way to <span class="stt">mzpp</span> since it
also uses <a href="overview.html" class="RktModLink" pltdoc="x"><span class="RktSym">preprocessor/pp-run</span></a> functionality.  However,
<span class="stt">mztext</span> uses a completely different processing principle, it is
similar to TeX rather than the simple interleaving of text and Scheme
code done by <span class="stt">mzpp</span>.</p><p>Text is being input from file(s), and by default copied to the
standard output.  However, there are some magic sequences that trigger
handlers that can take over this process &ndash; these handlers gain
complete control over what is being read and what is printed, and at
some point they hand control back to the main loop.  On a high-level
point of view, this is similar to &ldquo;programming&rdquo; in TeX, where macros
accept as input the current input stream.  The basic mechanism that
makes this programming is a <a name="(tech._composite._input._port)"></a><span style="font-style: italic">composite input port</span> which is a
prependable input port &ndash; so handlers are not limited to processing
input and printing output, they can append their output back on the
current input which will be reprocessed.</p><p>The bottom line of all this is that <span class="stt">mztext</span> is can perform more
powerful preprocessing than the <span class="stt">mzpp</span>, since you can define your own
language as the file is processed.</p><h4>3.1<tt>&nbsp;</tt><a name="(part._.Invoking_mztext)"></a>Invoking mztext</h4><p>Use the <span class="nobreak"><span class="stt">-h</span></span> flag to get the available flags.  SEE above for an
explanation of the <span class="nobreak"><span class="stt">--run</span></span> flag.</p><h4>3.2<tt>&nbsp;</tt><a name="(part._mztext_processing__the_standard_command_dispatcher)"></a>mztext processing: the standard command dispatcher</h4><p><span class="stt">mztext</span> can use arbitrary magic sequences, but for convenience,
there is a default built-in dispatcher that connects Scheme code with
the preprocessed text &ndash; by default, it is triggered by <span class="RktInBG"><span class="hspace"></span><span class="RktIn">@</span><span class="hspace"></span></span>.
When file processing encounters this marker, control is transfered to
the command dispatcher.  In its turn, the command dispatcher reads a
Scheme expression (using <span class="RktSym"><a href="../reference/Reading.html#(def._((quote._~23~25kernel)._read))" class="RktValLink" pltdoc="x">read</a></span>), evaluates it, and decides
what to do next.  In case of a simple Scheme value, it is converted to
a string and pushed back on the preprocessed input.  For example, the
following text:</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">foo</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@"bar"</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(+ 1 2)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@"@(* 3 4)"</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(/ (read) 3)12</span></span></p></td></tr></table></p><p>generates this output:</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">foo</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">bar</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">3</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">12</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">4</span></span></p></td></tr></table></p><p>An explanation of a few lines:</p><ul><li><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">@"bar"</span><span class="hspace"></span></span>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">@(+ 1 2)</span><span class="hspace"></span></span> &ndash; the Scheme objects
that is read is evaluated and displayed back on the input port which
is then printed.</p></li><li><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">@"@(* 3 4)"</span><span class="hspace"></span></span>  &ndash;  demonstrates that the results
are &ldquo;printed&rdquo; back on the input: the string that in this case
contains another use of <span class="RktInBG"><span class="hspace"></span><span class="RktIn">@</span><span class="hspace"></span></span> which will then get read back
in, evaluated, and displayed.</p></li><li><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">@(/ (read) 3)12</span><span class="hspace"></span></span>  &ndash;  demonstrates that the Scheme
code can do anything with the current input.</p></li></ul><p>The complete behavior of the command dispatcher follows:</p><ul><li><p>If the marker sequence is followed by itself, then it is simply
displayed, using the default, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">@@</span><span class="hspace"></span></span> outputs a <span class="RktInBG"><span class="hspace"></span><span class="RktIn">@</span><span class="hspace"></span></span>.</p></li><li><p>Otherwise a Scheme expression is read and evaluated, and the result is
processed as follows:</p><ul><li><p>If the result consists of multiple values, each one is processed,</p></li><li><p>If it is <span class="RktRes">#&lt;void&gt;</span> or <span class="RktVal">#f</span>, nothing is done,</p></li><li><p>If it is a structure of pairs, this structure is processed
recursively,</p></li><li><p>If it is a promise, it is forced and its value is used instead,</p></li><li><p>Strings, bytes, and paths are pushed back on the input stream,</p></li><li><p>Symbols, numbers, and characters are converted to strings and pushed
back on the input,</p></li><li><p>An input port will be perpended to the input, both processed as a
single input,</p></li><li><p>Procedures of one or zero arity are treated in a special way &ndash; see
below, other procedures cause an error</p></li><li><p>All other values are ignored.</p></li></ul></li><li><p>When this processing is done, and printable results have been re-added
to the input port, control is returned to the main processing loop.</p></li></ul><p>A built-in convenient behavior is that if the evaluation of the Scheme
expression returned a <span class="RktRes">#&lt;void&gt;</span> or <span class="RktVal">#f</span> value (or multiple values that are
all <span class="RktRes">#&lt;void&gt;</span> or <span class="RktVal">#f</span>), then the next newline is swallowed using
<span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._swallow-newline))" class="RktValLink" pltdoc="x">swallow-newline</a></span> (see below) if there is just white spaces before it.</p><p>During evaluation, printed output is displayed as is, without
re-processing.  It is not hard to do that, but it is a little expensive,
so the choice is to ignore it.  (A nice thing to do is to redesign this
so each evaluation is taken as a real filter, which is done in its own
thread, so when a Scheme expression is about to evaluated, it is done in
a new thread, and the current input is wired to that thread&rsquo;s output.
However, this is much too heavy for a "simple" preprocesser...)</p><p>So far, we get a language that is roughly the same as we get from <span class="stt">mzpp</span>
(with the added benefit of reprocessing generated text, which could be
done in a better way using macros).  The special treatment of procedure
values is what allows more powerful constructs.  There are handled by
their arity (preferring a the nullary treatment over the unary one):</p><ul><li><p>A procedure of arity 0 is simply invoked, and its resulting value is
  used.  The procedure can freely use the input stream to retrieve
  arguments.  For example, here is how to define a standard C function
  header for use in a Racket extension file:</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(define (cfunc)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(format</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">"Scheme_Object *~a(int argc, Scheme_Object *argv[])\n"</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(read-line)))</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@cfunc foo</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@cfunc bar</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">==&gt;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Scheme_Object * foo(int argc, Scheme_Object *argv[])</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Scheme_Object * bar(int argc, Scheme_Object *argv[])</span></span></p></td></tr></table></p><p>Note how <span class="RktSym"><a href="../reference/Byte_and_String_Input.html#(def._((quote._~23~25kernel)._read-line))" class="RktValLink" pltdoc="x">read-line</a></span> is used to retrieve an argument, and how this
  results in an extra space in the actual argument value.  Replacing
  this with <span class="RktSym"><a href="../reference/Reading.html#(def._((quote._~23~25kernel)._read))" class="RktValLink" pltdoc="x">read</a></span> will work slightly better, except that input will
  have to be a Scheme token (in addition, this will not consume the
  final newline so the extra one in the format string should be
  removed).  The <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="RktValLink" pltdoc="x">get-arg</a></span> function can be used to retrieve arguments
  more easily &ndash; by default, it will return any text enclosed by
  parenthesis, brackets, braces, or angle brackets (see below).  For
  example:</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(define (tt)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(format "&lt;tt&gt;~a&lt;/tt&gt;" (get-arg)))</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(define (ref)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(format "&lt;a href=~s&gt;~a&lt;/a&gt;" (get-arg) (get-arg)))</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(define (ttref)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(format "&lt;a href=~s&gt;@tt{~a}&lt;/a&gt;" (get-arg) (get-arg)))</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(define (reftt)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(format "&lt;a href=~s&gt;~a&lt;/a&gt;" (get-arg) (tt)))</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@ttref{www.racket-lang.org}{Racket}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@reftt{www.racket-lang.org}{Racket}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">==&gt;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;a href="www.racket-lang.org"&gt;&lt;tt&gt;Racket&lt;/tt&gt;&lt;/a&gt;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;a href="www.racket-lang.org"&gt;&lt;tt&gt;Racket&lt;/tt&gt;&lt;/a&gt;</span></span></p></td></tr></table></p><p>Note that in <span class="RktSym">reftt</span> we use <span class="RktSym">tt</span> without arguments since it will
  retrieve its own arguments.  This makes <span class="RktSym">ttref</span>&rsquo;s approach more
  natural, except that "calling" <span class="RktSym">tt</span> through a Scheme string doesn&rsquo;t
  seem natural.  For this there is a <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._defcommand))" class="RktValLink" pltdoc="x">defcommand</a></span> command (see below)
  that can be used to define such functions without using Scheme code:</p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@defcommand{tt}{X}{&lt;tt&gt;X&lt;/tt&gt;}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@defcommand{ref}{url text}{&lt;a href="url"&gt;text&lt;/a&gt;}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@defcommand{ttref}{url text}{&lt;a href="url"&gt;@tt{text}&lt;/a&gt;}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@ttref{www.racket-lang.org}{Racket}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">==&gt;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;a href="www.racket-lang.org"&gt;&lt;tt&gt;Racket&lt;/tt&gt;&lt;/a&gt;</span></span></p></td></tr></table></li><li><p>A procedure of arity 1 is invoked differently &ndash; it is applied on a
thunk that holds the "processing continuation".  This application is
not expected to return, instead, the procedure can decide to hand over
control back to the main loop by using this thunk.  This is a powerful
facility that is rarely needed, similarly to the fact that <span class="RktSym"><a href="../reference/cont.html#(def._((quote._~23~25kernel)._call/cc))" class="RktValLink" pltdoc="x">call/cc</a></span>
is rarely needed in Scheme.</p></li></ul><p>Remember that when procedures are used, generated output is not
reprocessed, just like evaluating other expressions.</p><h4>3.3<tt>&nbsp;</tt><a name="(part._mztext-lib)"></a><a name="(mod-path._preprocessor/mztext)"></a>Provided bindings</h4><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="stt"> </span><a href="#(mod-path._preprocessor/mztext)" class="RktModLink" pltdoc="x"><span class="RktSym">preprocessor/mztext</span></a><span class="RktPn">)</span></td></tr></table></p><p>Similarly to <span class="stt">mzpp</span>, <a href="#(mod-path._preprocessor/mztext)" class="RktModLink" pltdoc="x"><span class="RktSym">preprocessor/mztext</span></a> contains
both the implementation as well as user-visible bindings.</p><p>Dispatching-related bindings:</p><p><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._command-marker))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._command-marker))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._command-marker))" class="RktValLink" pltdoc="x">command-marker</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._command-marker))" class="RktValLink" pltdoc="x">command-marker</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">str</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">str</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span></td></tr></table></p><p>A string parameter-like procedure that can be used to set a
different command marker string.  Defaults to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">@</span><span class="hspace"></span></span>.  It can
also be set to <span class="RktVal">#f</span> which will disable the command dispatcher
altogether.  Note that this is a procedure &ndash; it cannot be used with
<span class="RktSym"><a href="../reference/parameters.html#(form._((lib._racket/private/more-scheme..rkt)._parameterize))" class="RktStxLink" pltdoc="x">parameterize</a></span>.</p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._dispatchers))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._dispatchers))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._dispatchers))" class="RktValLink" pltdoc="x">dispatchers</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list~3f))" class="RktValLink" pltdoc="x">list?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._dispatchers))" class="RktValLink" pltdoc="x">dispatchers</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">disps</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list~3f))" class="RktValLink" pltdoc="x">list?</a></span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">A parameter-like procedure (same as <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._command-marker))" class="RktValLink" pltdoc="x">command-marker</a></span>) holding a list
  of lists &ndash; each one a dispatcher regexp and a handler function.  The
  regexp should not have any parenthesized subgroups, use <span class="RktVal">"(?:...)"</span> for
  grouping.  The handler function is invoked whenever the regexp is seen
  on the input stream: it is invoked on two arguments &ndash; the matched
  string and a continuation thunk.  It is then responsible for the rest
  of the processing, usually invoking the continuation thunk to resume
  the default preprocessing.  For example:</div></p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(define (foo-handler str cont)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(add-to-input (list-&gt;string</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(reverse (string-&gt;list (get-arg)))))</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(cont))</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(dispatchers (cons (list "foo" foo-handler) (dispatchers)))</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">foo{&gt;Foo&lt;oof}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">==&gt;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Foo</span></span></p></td></tr></table></p><p>Note that the standard command dispatcher uses the same facility, and
  it is added by default to the dispatcher list unless <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._command-marker))" class="RktValLink" pltdoc="x">command-marker</a></span>
  is set to <span class="RktVal">#f</span>.</p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._make-composite-input))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._make-composite-input))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._make-composite-input))" class="RktValLink" pltdoc="x">make-composite-input</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="RktValLink" pltdoc="x">input-port?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></div><div class="SIntrapara">Creates a composite input port, initialized by the given values
(input ports, strings, etc).  The resulting port will read data from
each of the values in sequence, appending them together to form a
single input port.  This is very similar to
<span class="RktSym"><a href="../reference/port-lib.html#(def._((lib._racket/port..rkt)._input-port-append))" class="RktValLink" pltdoc="x">input-port-append</a></span>, but it is extended to allow prepending
additional values to the beginning of the port using
<span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._add-to-input))" class="RktValLink" pltdoc="x">add-to-input</a></span>.  The <span class="stt">mztext</span> executable relies on this
functionality to be able to push text back on the input when it is
supposed to be reprocessed, so use only such ports for the current
input port.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._add-to-input))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._add-to-input))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._add-to-input))" class="RktValLink" pltdoc="x">add-to-input</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></div><div class="SIntrapara">This should be used to &ldquo;output&rdquo; a string (or an input port) back
on the current composite input port.  As a special case, thunks can
be added to the input too &ndash; they will be executed when the &ldquo;read
header&rdquo; goes past them, and their output will be added back
instead.  This is used to plant handlers that happen when reading
beyond a specific point (for example, this is how the directory is
changed to the processed file to allow relative includes).  Other
simple values are converted to strings using <span class="RktSym"><a href="../reference/Writing.html#(def._((quote._~23~25kernel)._format))" class="RktValLink" pltdoc="x">format</a></span>, but
this might change.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._paren-pairs))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._paren-pairs))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._paren-pairs))" class="RktValLink" pltdoc="x">paren-pairs</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._list/c))" class="RktValLink" pltdoc="x">list/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._paren-pairs))" class="RktValLink" pltdoc="x">paren-pairs</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">pairs</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pairs</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._list/c))" class="RktValLink" pltdoc="x">list/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">This is a parameter holding a list of lists, each one holding two
strings which are matching open/close tokens for <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="RktValLink" pltdoc="x">get-arg</a></span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._get-arg-reads-word~3f))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._get-arg-reads-word~3f))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg-reads-word~3f))" class="RktValLink" pltdoc="x">get-arg-reads-word?</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg-reads-word~3f))" class="RktValLink" pltdoc="x">get-arg-reads-word?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">on?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">on?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">any/c</span></td></tr></table></div><div class="SIntrapara">A parameter that holds a boolean value defaulting to <span class="RktVal">#f</span>.  If true,
then <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="RktValLink" pltdoc="x">get-arg</a></span> will read a whole word (non-whitespace string delimited
by whitespaces) for arguments that are not parenthesized with a pair
in <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._paren-pairs))" class="RktValLink" pltdoc="x">paren-pairs</a></span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._get-arg))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._get-arg))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="RktValLink" pltdoc="x">get-arg</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="RktValLink" pltdoc="x">eof-object?</a></span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">This function will retrieve a text argument surrounded by a paren
  pair specified by <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._paren-pairs))" class="RktValLink" pltdoc="x">paren-pairs</a></span>.  First, an open-pattern is
  searched, and then text is assembled making sure that open-close
  patterns are respected, until a matching close-pattern is found.
  When this scan is performed, other parens are ignored, so if the
  input stream has <span class="RktInBG"><span class="hspace"></span><span class="RktIn">{[(}</span><span class="hspace"></span></span>, the return value will be
  <span class="RktVal">"[("</span>.  It is possible for both tokens to be the same, which
  will have no nesting possible.  If no open-pattern is found, the
  first non-whitespace character is used, and if that is also not
  found before the end of the input, an <span class="RktSym"><a href="../reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="RktValLink" pltdoc="x">eof</a></span> value is
  returned.  For example (using <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._defcommand))" class="RktValLink" pltdoc="x">defcommand</a></span> which uses
  <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="RktValLink" pltdoc="x">get-arg</a></span>):</div></p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(paren-pairs (cons (list "|" "|") (paren-pairs)))</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@defcommand{verb}{X}{&lt;tt&gt;X&lt;/tt&gt;}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@verb abc</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@(get-arg-reads-word? #t)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@verb abc</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@verb |FOO|</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@verb</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">==&gt;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;tt&gt;a&lt;/tt&gt;bc</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;tt&gt;abc&lt;/tt&gt;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;tt&gt;FOO&lt;/tt&gt;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">verb: expecting an argument for `X'</span></span></p></td></tr></table></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._get-arg*))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._get-arg*))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg*))" class="RktValLink" pltdoc="x">get-arg*</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="RktValLink" pltdoc="x">eof-object?</a></span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="RktValLink" pltdoc="x">get-arg</a></span>, except that the resulting text is first
processed.  Since arguments are usually text strings,
&ldquo;programming&rdquo; can be considered as lazy evaluation, which
sometimes can be too inefficient (TeX suffers from the same
problem).  The <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg*))" class="RktValLink" pltdoc="x">get-arg*</a></span> function can be used to reduce some
inputs immediately after they have been read.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._swallow-newline))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._swallow-newline))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._swallow-newline))" class="RktValLink" pltdoc="x">swallow-newline</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr></table></div><div class="SIntrapara">This is a simple command that simply does this:</div></p><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/regexp.html#(def._((lib._racket/private/base..rkt)._regexp-try-match))" class="RktValLink" pltdoc="x">regexp-try-match</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#rx"^[ \t]*\r?\n"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._stdin))" class="RktValLink" pltdoc="x">stdin</a></span><span class="RktPn">)</span><span class="RktPn">)</span></p><p>The result is that a newline will be swallowed if there is only
  whitespace from the current location to the end of the line.  Note
  that as a general principle <span class="RktSym"><a href="../reference/regexp.html#(def._((lib._racket/private/base..rkt)._regexp-try-match))" class="RktValLink" pltdoc="x">regexp-try-match</a></span> should be
  preferred over <span class="RktSym"><a href="../reference/regexp.html#(def._((quote._~23~25kernel)._regexp-match))" class="RktValLink" pltdoc="x">regexp-match</a></span> for <span class="stt">mztext</span>&rsquo;s
  preprocessing.</p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._defcommand))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._defcommand))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._defcommand))" class="RktValLink" pltdoc="x">defcommand</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktVar">args</span><span class="hspace">&nbsp;</span><span class="RktVar">text</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">args</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list~3f))" class="RktValLink" pltdoc="x">list?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">text</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="RktValLink" pltdoc="x">string?</a></span></td></tr></table></div><div class="SIntrapara">This is a command that can be used to define simple template
  commands.  It should be used as a command, not from Scheme code
  directly, and it should receive three arguments:</div></p><ul><li><p>The name for the new command (the contents of this argument is
converted to a string),</p></li><li><p>The list of arguments (the contents of this is turned to a list of
identifiers),</p></li><li><p>Arbitrary text, with <span style="font-weight: bold">textual</span> instances of the variables that
denote places they are used.</p></li></ul><p>For example, the sample code above:</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">@defcommand{ttref}{url text}{&lt;a href="url"&gt;@tt{text}&lt;/a&gt;}</span></span></p></td></tr></table></p><p>is translated to the following definition expression:</p><p><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ttref</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">url</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="RktValLink" pltdoc="x">get-arg</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">text</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="RktValLink" pltdoc="x">get-arg</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="RktValLink" pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"&lt;a href=\""</span><span class="hspace">&nbsp;</span><span class="RktSym">url</span><span class="hspace">&nbsp;</span><span class="RktVal">"\"&gt;@tt{"</span><span class="hspace">&nbsp;</span><span class="RktVar">text</span><span class="hspace">&nbsp;</span><span class="RktVal">"}&lt;/a&gt;"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></p><p>which is then evaluated.  Note that the arguments play a role as both
  Scheme identifiers and textual markers.</p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._include))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._include))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._include))" class="RktValLink" pltdoc="x">include</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">file</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">file</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#(def._((lib._racket/private/misc..rkt)._path-string~3f))" class="RktValLink" pltdoc="x">path-string?</a></span></td></tr></table></div><div class="SIntrapara">This will add all of the given inputs to the composite port and run
the preprocessor loop.  In addition to the given inputs, some thunks
are added to the input port (see <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._add-to-input))" class="RktValLink" pltdoc="x">add-to-input</a></span> above) to change
directory so relative includes work.</div></p><p>If it is called with no arguments, it will use <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._get-arg))" class="RktValLink" pltdoc="x">get-arg</a></span> to get an
input filename, therefore making it possible to use this as a
dispatcher command as well.</p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._preprocess))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._preprocess))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._preprocess))" class="RktValLink" pltdoc="x">preprocess</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">in</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">in</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#(def._((lib._racket/private/misc..rkt)._path-string~3f))" class="RktValLink" pltdoc="x">path-string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="RktValLink" pltdoc="x">input-port?</a></span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">This is the main entry point to the preprocessor &ndash; creating a new
composite port, setting internal parameters, then calling <span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._include))" class="RktValLink" pltdoc="x">include</a></span> to
start the preprocessing.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><table cellspacing="0" class="together"><tr><td><a name="(dep._((lib._preprocessor/mztext..rkt)._stdin))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._stdin))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._stdin))" class="RktValLink" pltdoc="x">stdin</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/parameters.html#(def._((quote._~23~25kernel)._parameter~3f))" class="RktValLink" pltdoc="x">parameter?</a></span></td></tr></table></td></tr><tr><td><table cellspacing="0" class="together"><tr><td><a name="(dep._((lib._preprocessor/mztext..rkt)._stdout))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._stdout))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._stdout))" class="RktValLink" pltdoc="x">stdout</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/parameters.html#(def._((quote._~23~25kernel)._parameter~3f))" class="RktValLink" pltdoc="x">parameter?</a></span></td></tr></table></td></tr><tr><td><table cellspacing="0" class="together"><tr><td><a name="(dep._((lib._preprocessor/mztext..rkt)._stderr))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._stderr))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._stderr))" class="RktValLink" pltdoc="x">stderr</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/parameters.html#(def._((quote._~23~25kernel)._parameter~3f))" class="RktValLink" pltdoc="x">parameter?</a></span></td></tr></table></td></tr><tr><td><table cellspacing="0" class="together"><tr><td><a name="(dep._((lib._preprocessor/mztext..rkt)._cd))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._cd))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._cd))" class="RktValLink" pltdoc="x">cd</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/parameters.html#(def._((quote._~23~25kernel)._parameter~3f))" class="RktValLink" pltdoc="x">parameter?</a></span></td></tr></table></td></tr></table></div><div class="SIntrapara">These are shorter names for the corresponding port parameters and
<span class="RktSym"><a href="../reference/Filesystem.html#(def._((quote._~23~25kernel)._current-directory))" class="RktValLink" pltdoc="x">current-directory</a></span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._preprocessor/mztext..rkt)._current-file))"></a><a name="(def._((lib._preprocessor/mztext..rkt)._current-file))"></a><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._current-file))" class="RktValLink" pltdoc="x">current-file</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#(def._((lib._racket/private/misc..rkt)._path-string~3f))" class="RktValLink" pltdoc="x">path-string?</a></span></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: preprocessor/mztext"><span class="RktSym"><a href="#(def._((lib._preprocessor/mztext..rkt)._current-file))" class="RktValLink" pltdoc="x">current-file</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">path</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">path</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#(def._((lib._racket/private/misc..rkt)._path-string~3f))" class="RktValLink" pltdoc="x">path-string?</a></span></td></tr></table></div><div class="SIntrapara">This is a parameter that holds the name of the currently processed
file, or #f if none.</div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="mzpp.html" title="backward to &quot;2 mzpp&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;mzpp and mztext: Preprocessors&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>