<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>1.3&nbsp;Editor</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span style="font-weight: bold">GUI</span>:<span class="mywbr"> </span> Racket Graphics Toolkit</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Overview.html" class="tocviewselflink" pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Reference.html" class="tocviewlink" pltdoc="x">Reference</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Configuration.html" class="tocviewlink" pltdoc="x">Configuration</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Dynamic_Loading.html" class="tocviewlink" pltdoc="x">Dynamic Loading</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>1&nbsp;</td><td><a href="Overview.html" class="tocviewlink" pltdoc="x">Overview</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="windowing-overview.html" class="tocviewlink" pltdoc="x">Windowing</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="drawing-overview.html" class="tocviewlink" pltdoc="x">Drawing</a></td></tr><tr><td align="right">1.3&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Editor</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td>1.3&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Editor</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.3.1&nbsp;</td><td><a href="#(part._tb~3amiaoverview)" class="tocviewlink" pltdoc="x">Editor Structure and Terminology</a></td></tr><tr><td align="right">1.3.2&nbsp;</td><td><a href="#(part._editorfileformat)" class="tocviewlink" pltdoc="x">File Format</a></td></tr><tr><td align="right">1.3.3&nbsp;</td><td><a href="#(part._editoreol)" class="tocviewlink" pltdoc="x">End of Line Ambiguity</a></td></tr><tr><td align="right">1.3.4&nbsp;</td><td><a href="#(part._editorflattened)" class="tocviewlink" pltdoc="x">Flattened Text</a></td></tr><tr><td align="right">1.3.5&nbsp;</td><td><a href="#(part._drawcaretinfo)" class="tocviewlink" pltdoc="x">Caret Ownership</a></td></tr><tr><td align="right">1.3.6&nbsp;</td><td><a href="#(part._editorcutandpastetime)" class="tocviewlink" pltdoc="x">Cut and Paste Time Stamps</a></td></tr><tr><td align="right">1.3.7&nbsp;</td><td><a href="#(part._editorclickback)" class="tocviewlink" pltdoc="x">Clickbacks</a></td></tr><tr><td align="right">1.3.8&nbsp;</td><td><a href="#(part._lockinfo)" class="tocviewlink" pltdoc="x">Internal Editor Locks</a></td></tr><tr><td align="right">1.3.9&nbsp;</td><td><a href="#(part._editorthreads)" class="tocviewlink" pltdoc="x">Editors and Threads</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1.3.1<tt>&nbsp;</tt></span><a href="#(part._tb~3amiaoverview)" class="tocsubseclink" pltdoc="x">Editor Structure and Terminology</a></td></tr><tr><td><span class="tocsublinknumber">1.3.1.1<tt>&nbsp;</tt></span><a href="#(part._editoradministrators)" class="tocsubseclink" pltdoc="x">Administrators</a></td></tr><tr><td><span class="tocsublinknumber">1.3.1.2<tt>&nbsp;</tt></span><a href="#(part._editorstyles)" class="tocsubseclink" pltdoc="x">Styles</a></td></tr><tr><td><span class="tocsublinknumber">1.3.2<tt>&nbsp;</tt></span><a href="#(part._editorfileformat)" class="tocsubseclink" pltdoc="x">File Format</a></td></tr><tr><td><span class="tocsublinknumber">1.3.2.1<tt>&nbsp;</tt></span><a href="#(part._.Encoding_.Snips)" class="tocsubseclink" pltdoc="x">Encoding Snips</a></td></tr><tr><td><span class="tocsublinknumber">1.3.2.1.1<tt>&nbsp;</tt></span><a href="#(part._editorsnipclasses)" class="tocsubseclink" pltdoc="x">Snip Classes</a></td></tr><tr><td><span class="tocsublinknumber">1.3.2.1.2<tt>&nbsp;</tt></span><a href="#(part._editordata)" class="tocsubseclink" pltdoc="x">Editor Data</a></td></tr><tr><td><span class="tocsublinknumber">1.3.2.2<tt>&nbsp;</tt></span><a href="#(part._globaleditordata)" class="tocsubseclink" pltdoc="x">Global Data:<span class="mywbr"> </span> Headers and Footers</a></td></tr><tr><td><span class="tocsublinknumber">1.3.3<tt>&nbsp;</tt></span><a href="#(part._editoreol)" class="tocsubseclink" pltdoc="x">End of Line Ambiguity</a></td></tr><tr><td><span class="tocsublinknumber">1.3.4<tt>&nbsp;</tt></span><a href="#(part._editorflattened)" class="tocsubseclink" pltdoc="x">Flattened Text</a></td></tr><tr><td><span class="tocsublinknumber">1.3.5<tt>&nbsp;</tt></span><a href="#(part._drawcaretinfo)" class="tocsubseclink" pltdoc="x">Caret Ownership</a></td></tr><tr><td><span class="tocsublinknumber">1.3.6<tt>&nbsp;</tt></span><a href="#(part._editorcutandpastetime)" class="tocsubseclink" pltdoc="x">Cut and Paste Time Stamps</a></td></tr><tr><td><span class="tocsublinknumber">1.3.7<tt>&nbsp;</tt></span><a href="#(part._editorclickback)" class="tocsubseclink" pltdoc="x">Clickbacks</a></td></tr><tr><td><span class="tocsublinknumber">1.3.8<tt>&nbsp;</tt></span><a href="#(part._lockinfo)" class="tocsubseclink" pltdoc="x">Internal Editor Locks</a></td></tr><tr><td><span class="tocsublinknumber">1.3.9<tt>&nbsp;</tt></span><a href="#(part._editorthreads)" class="tocsubseclink" pltdoc="x">Editors and Threads</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="drawing-overview.html" title="backward to &quot;1.2 Drawing&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Overview.html" title="up to &quot;1 Overview&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="Reference.html" title="forward to &quot;2 Reference&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>1.3<tt>&nbsp;</tt><a name="(part._editor-overview)"></a>Editor</h4><p>The editor toolbox provides a foundation for two common kinds of
 applications:</p><ul><li><p><span style="font-style: italic">Programs that need a sophisticated text editor</span>  &ndash; 
The simple text field control is inadequate for text-intensive
applications.  Many programs need editors that can handle multiple
fonts and non-text items.</p></li><li><p><span style="font-style: italic">Programs that need a canvas with dragable objects</span>  &ndash; 
The drawing toolbox provides a generic drawing surface for plotting
lines and boxes, but many applications need an interactive canvas,
where the user can drag and resize individual objects.</p></li></ul><p>Both kinds of applications need an extensible editor that can handle
 text, images, programmer-defined items, and even embedded
 editors. The difference between them is the layout of items. The
 editor toolbox therefore provides two kinds of editors via two
 classes:</p><ul><li><p><span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span>  &ndash;  in a <a name="(tech._text._editor)"></a><span style="font-style: italic">text editor</span>, items are
automatically positioned in a paragraph flow.</p></li><li><p><span class="RktSym"><a href="pasteboard_.html" class="RktValLink" pltdoc="x">pasteboard%</a></span>  &ndash;  in a <a name="(tech._pasteboard._editor)"></a><span style="font-style: italic">pasteboard editor</span>,
items are explicitly positioned and dragable.</p></li></ul><p>This editor architecture addresses the full range of real-world
 issues for an editor &ndash; including cut-and-paste, extensible file
 formats, and layered text styles &ndash; while supporting a high level of
 extensibility.  Unfortunately, the system is fairly complex as a
 result, and using the editor classes effectively requires a solid
 understanding of the structure and terminology of the editor
 toolbox. Nevertheless, enough applications fit one (or both) of the
 descriptions above to justify the depth and complexity of the toolbox
 and the learning investment required to use it.</p><p>A brief example illustrates how editors work. To start, an editor
 needs an <span class="RktSym"><a href="editor-canvas_.html" class="RktValLink" pltdoc="x">editor-canvas%</a></span> to display its contents. Then, we
 can create a text editor and install it into the canvas:</p><p><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" class="RktStxLink" pltdoc="x">new</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="frame_.html" class="RktValLink" pltdoc="x">frame%</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">label</span><span class="hspace">&nbsp;</span><span class="RktVal">"Simple Edit"</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">width</span><span class="hspace">&nbsp;</span><span class="RktVal">200</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">height</span><span class="hspace">&nbsp;</span><span class="RktVal">200</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" class="RktStxLink" pltdoc="x">new</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="editor-canvas_.html" class="RktValLink" pltdoc="x">editor-canvas%</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">parent</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" class="RktStxLink" pltdoc="x">new</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="RktStxLink" pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="editor-canvas_.html#(meth._(((lib._mred/main..rkt)._editor-canvas~25)._set-editor))" class="RktValLink" pltdoc="x">set-editor</a></span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="RktStxLink" pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="top-level-window___.html#(meth._(((lib._mred/main..rkt)._top-level-window~3c~25~3e)._show))" class="RktValLink" pltdoc="x">show</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr></table></p><p>At this point, the editor is fully functional: the user can type text
 into the editor, but no cut-and-paste operations are available. We
 can support all of the standard operations on an editor via the
 menu bar:</p><p><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mb</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" class="RktStxLink" pltdoc="x">new</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="menu-bar_.html" class="RktValLink" pltdoc="x">menu-bar%</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">parent</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">m-edit</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" class="RktStxLink" pltdoc="x">new</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="menu_.html" class="RktValLink" pltdoc="x">menu%</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">label</span><span class="hspace">&nbsp;</span><span class="RktVal">"Edit"</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">parent</span><span class="hspace">&nbsp;</span><span class="RktSym">mb</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">m-font</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" class="RktStxLink" pltdoc="x">new</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="menu_.html" class="RktValLink" pltdoc="x">menu%</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">label</span><span class="hspace">&nbsp;</span><span class="RktVal">"Font"</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">parent</span><span class="hspace">&nbsp;</span><span class="RktSym">mb</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._append-editor-operation-menu-items))" class="RktValLink" pltdoc="x">append-editor-operation-menu-items</a></span><span class="hspace">&nbsp;</span><span class="RktSym">m-edit</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._append-editor-font-menu-items))" class="RktValLink" pltdoc="x">append-editor-font-menu-items</a></span><span class="hspace">&nbsp;</span><span class="RktSym">m-font</span><span class="RktPn">)</span></td></tr></table></p><p>Now, the standard cut and paste operations work, and the user can even
 set font styles. The user can also insert an embedded editor by
 selecting <span style="font-family: sans-serif; font-size: 80%; font-weight: bold">Insert Text</span> from the <span style="font-family: sans-serif; font-size: 80%; font-weight: bold">Edit</span> menu; after
 selecting the menu item, a box appears in the editor with the caret
 inside. Typing with the caret in the box stretches the box as text is
 added, and font operations apply wherever the caret is active. Text
 on the outside of the box is rearranged as the box changes
 sizes. Note that the box itself can be copied and pasted.</p><p>The content of an editor is made up of <span style="font-style: italic"><a href="#(tech._snip)" class="techoutside" pltdoc="x"><span class="techinside">snips</span></a></span>. An
 embedded editor is a single snip from the embedding editor&rsquo;s
 point-of-view. To encode immediate text, a snip can be a single
 character, but more often a snip is a sequence of adjacent characters
 on the same line. The <span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._find-snip))" class="RktValLink" pltdoc="x">find-snip</a></span> method extracts a snip
 from a text editor:</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="RktStxLink" pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._find-snip))" class="RktValLink" pltdoc="x">find-snip</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">after</span><span class="RktPn">)</span></p><p>The above expression returns the first snip in the editor, which may
 be a string snip (for immediate text) or an editor snip (for an
 embedded editor).</p><p>An editor is not permanently attached to any display. We can take the
 text editor out of our canvas and put a pasteboard editor in the
 canvas, instead:</p><p><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pb</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" class="RktStxLink" pltdoc="x">new</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="pasteboard_.html" class="RktValLink" pltdoc="x">pasteboard%</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="RktStxLink" pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="editor-canvas_.html#(meth._(((lib._mred/main..rkt)._editor-canvas~25)._set-editor))" class="RktValLink" pltdoc="x">set-editor</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pb</span><span class="RktPn">)</span></td></tr></table></p><p>With the pasteboard editor installed, the user can no longer type
 characters directly into the editor (because a pasteboard does not
 support directly entered text). However, the user can cut text from
 elsewhere and paste it into pasteboard, or select one of the
 <span style="font-family: sans-serif; font-size: 80%; font-weight: bold">Insert</span> menu items in the <span style="font-family: sans-serif; font-size: 80%; font-weight: bold">Edit</span> menu. Snips are
 clearly identifiable in a pasteboard editor (unlike a text editor)
 because each snip is separately dragable.</p><p>We can insert the old text editor (which we recently removed from the
 canvas) as an embedded editor in the pasteboard by explicitly
 creating an editor snip:</p><p><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" class="RktValLink" pltdoc="x">make-object</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="editor-snip_.html" class="RktValLink" pltdoc="x">editor-snip%</a></span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktSym">t</span><span class="RktCmt"> is the old text editor</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="RktStxLink" pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pb</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._insert))" class="RktValLink" pltdoc="x">insert</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr></table></p><p>An individual snip cannot be inserted into different editors at the
 same time, or inserted multiple times in the same editor:</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="RktStxLink" pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pb</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._insert))" class="RktValLink" pltdoc="x">insert</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">no effect</span></p><p>However, we can make a deep copy of the snip and insert the copy into
 the pasteboard:</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="RktStxLink" pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pb</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._insert))" class="RktValLink" pltdoc="x">insert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="RktStxLink" pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="snip_.html#(meth._(((lib._mred/main..rkt)._snip~25)._copy))" class="RktValLink" pltdoc="x">copy</a></span><span class="RktPn">)</span><span class="RktPn">)</span></p><p>Applications that use the editor classes typically derive new versions
 of the <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> and <span class="RktSym"><a href="pasteboard_.html" class="RktValLink" pltdoc="x">pasteboard%</a></span> classes. For
 example, to implement an append-only editor (which allows insertions
 only at the end and never allows deletions), derive a new class from
 <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> and override the
 <span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._can-insert~3f))" class="RktValLink" pltdoc="x">can-insert?</a></span> and
 <span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._can-delete~3f))" class="RktValLink" pltdoc="x">can-delete?</a></span> methods:</p><p><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">append-only-text%</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" class="RktStxLink" pltdoc="x">class</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._inherit))" class="RktStxLink" pltdoc="x">inherit</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._last-position))" class="RktValLink" pltdoc="x">last-position</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/augment))" class="RktStxLink" pltdoc="x">define/augment</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._can-insert~3f))" class="RktValLink" pltdoc="x">can-insert?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3d))" class="RktValLink" pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._last-position))" class="RktValLink" pltdoc="x">last-position</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/augment))" class="RktStxLink" pltdoc="x">define/augment</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._can-delete~3f))" class="RktValLink" pltdoc="x">can-delete?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._super-new))" class="RktStxLink" pltdoc="x">super-new</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></p><h5>1.3.1<tt>&nbsp;</tt><a name="(part._tb~3amiaoverview)"></a>Editor Structure and Terminology</h5><p>The editor toolbox supports extensible and nestable editors by
 decomposing an editor assembly into three functional parts:</p><ul><li><p>The <a name="(tech._editor)"></a><span style="font-style: italic">editor</span> itself stores the state of the text or
pasteboard and handles most events and editing operations. The
<span class="RktSym"><a href="editor___.html" class="RktValLink" pltdoc="x">editor&lt;%&gt;</a></span> interface defines the core editor functionality,
but editors are created as instances of <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> or
<span class="RktSym"><a href="pasteboard_.html" class="RktValLink" pltdoc="x">pasteboard%</a></span>.</p></li><li><p>A <a name="(tech._snip)"></a><span style="font-style: italic">snip</span> is a segment of information within the
editor.  Each snip can contain a sequence of characters, a picture,
or an interactive object (such as an embedded editor). In a text
editor, snips are constrained to fit on a single line and generally
contain data of a single type. The <span class="RktSym"><a href="snip_.html" class="RktValLink" pltdoc="x">snip%</a></span> class implements a
basic snip. Other snip classes include <span class="RktSym"><a href="string-snip_.html" class="RktValLink" pltdoc="x">string-snip%</a></span> for
managing text, <span class="RktSym"><a href="image-snip_.html" class="RktValLink" pltdoc="x">image-snip%</a></span> for managing pictures, and
<span class="RktSym"><a href="editor-snip_.html" class="RktValLink" pltdoc="x">editor-snip%</a></span> for managing embedded editors.</p></li><li><p>A <a name="(tech._display)"></a><span style="font-style: italic">display</span> presents the editor on the screen. The
display lets the user scroll around an editor or change editors. Most
displays are instances of the <span class="RktSym"><a href="editor-canvas_.html" class="RktValLink" pltdoc="x">editor-canvas%</a></span> class, but the
<span class="RktSym"><a href="editor-snip_.html" class="RktValLink" pltdoc="x">editor-snip%</a></span> class also acts as a display for embedded
editors.</p></li></ul><p>These three parts are illustrated by a simple word processor. The
 editor corresponds to the text document. The editor object receives
 keyboard and mouse commands for editing the text. The text itself is
 distributed among snips. Each character could be a separate snip, or
 multiple characters on a single line could be grouped together into a
 snip. The display roughly corresponds to the window in which the
 text is displayed.  While the editor manages the arrangement of the
 text as it is displayed into a window, the display determines which
 window to draw into and which part of the editor to display.</p><p>Each selectable entity in an editor is an <a name="(tech._item)"></a><span style="font-style: italic">item</span>. In a
 pasteboard, all selection and dragging operations work on snips, so
 there is a one-to-one correspondence between snips and items.  In an
 editor, one snip contains one or more consecutive items, and every
 item belongs to some snip. For example, in a simple text editor, each
 character is an item, but multiple adjacent characters may be grouped
 into a single snip. The number of items in a snip is the snip&rsquo;s
 <a name="(tech._count)"></a><span style="font-style: italic">count</span>.</p><p>Each place where the insertion point can appear in a text editor is a
 <a name="(tech._position)"></a><span style="font-style: italic">position</span>. A text editor with <span style="font-style: italic">n</span> items contains
 <span style="font-style: italic">n+</span>1<span style="font-style: italic"></span> positions: one position before each item, and one position
 after the last item.</p><p>The order of snips within a pasteboard determines each snip&rsquo;s drawing
 plane. When two snips overlap within the pasteboard, the snip that is
 earlier in the order is in front of the other snip (i.e., the former
 is drawn after the latter, such that the former snip may cover part
 of the latter snip).</p><p>When an editor is drawn into a display, each snip and position has a
 <a name="(tech._location)"></a><span style="font-style: italic">location</span>. The location of a position or snip is specified
 in coordinates relative to the top-left corner of the
 editor. Locations in an editor are only meaningful when the editor is
 displayed.</p><h5>1.3.1.1<tt>&nbsp;</tt><a name="(part._editoradministrators)"></a>Administrators</h5><p>Two extra layers of administration manage the <a href="#(tech._display)" pltdoc="x">display</a>-editor and
 editor-snip connections. An editor never communicates directly with
 a <a href="#(tech._display)" pltdoc="x">display</a>; instead, it always communicates with an <a name="(tech._editor._administrator)"></a><span style="font-style: italic">editor
administrator</span>, an instance of the <span class="RktSym"><a href="editor-admin_.html" class="RktValLink" pltdoc="x">editor-admin%</a></span> class,
 which relays information to the <a href="#(tech._display)" pltdoc="x">display</a>. Similarly, a snip
 communicates with a <a name="(tech._snip._administrator)"></a><span style="font-style: italic">snip administrator</span>, an instance of the
 <span class="RktSym"><a href="snip-admin_.html" class="RktValLink" pltdoc="x">snip-admin%</a></span> class.</p><p>The administrative layers make the editor hierarchy flexible without
 forcing every part of an editor assembly to contain the functionality
 of several parts. For example, a text editor can be a single
 <a href="#(tech._item)" pltdoc="x">item</a> within another editor; without administrators, the
 <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> class would also have to contain all the functionality
 of a <a href="#(tech._display)" pltdoc="x">display</a> (for the containing editor) and a snip (for
 the embedded editor). Using administrators, an editor class can serve
 as both a containing and an embedded editor without directly
 implementing the <a href="#(tech._display)" pltdoc="x">display</a> and snip functionality.</p><p>A snip belongs to at most one editor via a single administrator. An
 editor also has only one administrator at a time. However, the
 administrator that connects the an editor to the standard
 <a href="#(tech._display)" pltdoc="x">display</a> (i.e., an editor canvas) can work with other such
 administrators. In particular, the administrator of an
 <span class="RktSym"><a href="editor-canvas_.html" class="RktValLink" pltdoc="x">editor-canvas%</a></span> (each one has its own administrator) can work
 with other <span class="RktSym"><a href="editor-canvas_.html" class="RktValLink" pltdoc="x">editor-canvas%</a></span> administrators, allowing an editor
 to be displayed in multiple <span class="RktSym"><a href="editor-canvas_.html" class="RktValLink" pltdoc="x">editor-canvas%</a></span> windows at the
 same time.</p><p>When an editor is displayed by multiple canvases, one of the canvases&rsquo;
 administrators is used as the editor&rsquo;s primary administrator. To
 handle user and update events for other canvases, the editor&rsquo;s
 administrator is temporarily changed and then restored through the
 editor&rsquo;s <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._set-admin))" class="RktValLink" pltdoc="x">set-admin</a></span> method. The return value of the
 editor&rsquo;s <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._get-admin))" class="RktValLink" pltdoc="x">get-admin</a></span> method thus depends on the
 context of the call.</p><h5>1.3.1.2<tt>&nbsp;</tt><a name="(part._editorstyles)"></a>Styles</h5><p>A <a name="(tech._style)"></a><span style="font-style: italic">style</span>, an instance of the <span class="RktSym"><a href="style___.html" class="RktValLink" pltdoc="x">style&lt;%&gt;</a></span> interface,
 parameterizes high-level display information that is common to all
 snip classes. This includes the font, color, and alignment for
 drawing the item. A single style is attached to each snip.</p><p>Styles are hierarchical: each style is defined in terms of another
 style. <a name="(idx._(gentag._13._(lib._scribblings/gui/gui..scrbl)))"></a>There is a single <a name="(tech._root._style)"></a><span style="font-style: italic">root style</span>, named
 <span class="RktVal">"Basic"</span>, from which all other styles in an editor are
 derived. The difference between a base style and each of its derived
 style is encoded in a <a name="(tech._style._delta)"></a><span style="font-style: italic">style delta</span> (or simply
 <a name="(tech._delta)"></a><span style="font-style: italic">delta</span>). A delta encodes changes such as</p><ul><li><p>change the font family to <span style="font-style: italic">X</span>;</p></li><li><p>enlarge the font by adding <span style="font-style: italic">Y</span> to the point size;</p></li><li><p>toggle the boldness of the font; or</p></li><li><p>change everything to match the style description <span style="font-style: italic">Z</span>.</p></li></ul><p>Style objects are never created separately; rather, they are always
 created through a <a name="(tech._style._list)"></a><span style="font-style: italic">style list</span>, an instance of the
 <span class="RktSym"><a href="style-list_.html" class="RktValLink" pltdoc="x">style-list%</a></span> class. A style list manages the styles,
 servicing external requests to find a particular style, and it
 manages the hierarchical relationship between styles.  A global style
 list is available, <a name="(idx._(gentag._14._(lib._scribblings/gui/gui..scrbl)))"></a><span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._the-style-list))" class="RktValLink" pltdoc="x">the-style-list</a></span>, but new style
 lists can be created for managing separate style hierarchies. For
 example, each editor will typically have its own style list.</p><p>Each new style is defined in one of two ways:</p><ul><li><p>A <a name="(tech._derived._style)"></a><span style="font-style: italic">derived style</span> is defined in terms of a base style
and a delta. Every style (except for the root style) has a base
style, even if it does not depend on the base style in any way (i.e.,
the delta describes a fixed style rather than extensions to an
existing style). (This is the usual kind of style inheritance, as
found in word processors such as Microsoft Word.)</p></li><li><p>A <a name="(tech._join._style)"></a><span style="font-style: italic">join style</span> is defined in terms of two other styles:
a base style and a <a name="(tech._shift._style)"></a><span style="font-style: italic">shift style</span>. The meaning of a join style
is determined by reinterpreting the shift style; in the
reinterpretation, the base style is used as the <span style="font-style: italic">root</span> style
for the shift style. (This is analogous to multi-level
styles, like the paragraph and character styles in FrameMaker. In
this analogy, the paragraph style is the base style, and the
character style is the shift style.  However, FrameMaker allows only
those two levels; with join styles support any number of levels.)</p></li></ul><p><a name="(idx._(gentag._15._(lib._scribblings/gui/gui..scrbl)))"></a>Usually, when text is inserted into a text editor, it
 inherits the style of the preceding snip. If text is inserted into an
 empty editor, the text is usually assigned a style called
 <span class="RktVal">"Standard"</span>. By default, the <span class="RktVal">"Standard"</span> style is
 unmodified from the root style. The default style name can be changed
 by overriding <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._default-style-name))" class="RktValLink" pltdoc="x">default-style-name</a></span>.</p><p>The exception to the above is when <span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._change-style))" class="RktValLink" pltdoc="x">change-style</a></span> in <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> is
 called with the current selection <a href="#(tech._position)" pltdoc="x">position</a> (when the
 selection is a <a href="#(tech._position)" pltdoc="x">position</a> and not a range). In that case,
 the style is remembered, and if the next editor-modifying action is a
 text insertion, the inserted text gets the remembered style.</p><p>See <span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._get-styles-sticky))" class="RktValLink" pltdoc="x">get-styles-sticky</a></span> in <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> for more information about the
 style of inserted text.</p><h5>1.3.2<tt>&nbsp;</tt><a name="(part._editorfileformat)"></a>File Format</h5><p>To allow editor content to be saved to a file, the editor classes
 implement a special file format called <a name="(tech._wxme)"></a><span style="font-style: italic">WXME</span>. (The format is
 used when cutting and pasting between applications or eventspaces,
 too). The file format is not documented, except that it begins
 <span class="RktInBG"><span class="hspace"></span><span class="RktIn">WXME01</span><span class="hspace"></span></span>&#8249;<span style="font-style: italic">digit</span>&#8250;&#8249;<span style="font-style: italic">digit</span>&#8250;<span class="RktInBG"><span class="hspace">&nbsp;</span><span class="RktIn">##</span><span class="hspace">&nbsp;</span></span>. Otherwise, the
 <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._load-file))" class="RktValLink" pltdoc="x">load-file</a></span> and <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._save-file))" class="RktValLink" pltdoc="x">save-file</a></span> methods
 define the format internally. The file format is the same for text
 and pasteboard editors. When a pasteboard saves its content to a
 file, it saves the snips from front to back, and also includes extra
 location information. The <a href="WXME_Decoding.html" class="RktModLink" pltdoc="x"><span class="RktSym">wxme</span></a> library provides
 utilities for manipulating WXME files.</p><p>Editor data is read and written using <span class="RktSym"><a href="editor-stream-in_.html" class="RktValLink" pltdoc="x">editor-stream-in%</a></span> and
<span class="RktSym"><a href="editor-stream-out_.html" class="RktValLink" pltdoc="x">editor-stream-out%</a></span> objects.  Editor information can only be
 read from or written to one stream at a time. To write one or more
 editors to a stream, first call the function
 <span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._write-editor-global-header))" class="RktValLink" pltdoc="x">write-editor-global-header</a></span> to write initialization data into
 an output stream. When all editors are written to the stream, call
 <span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._write-editor-global-footer))" class="RktValLink" pltdoc="x">write-editor-global-footer</a></span>. Similarly, reading editors from
 a stream is initialized with <span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._read-editor-global-header))" class="RktValLink" pltdoc="x">read-editor-global-header</a></span> and
 finalized with <span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._read-editor-global-footer))" class="RktValLink" pltdoc="x">read-editor-global-footer</a></span>. Optionally, to
 support streams that span versions of Racket, use
 <span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._write-editor-version))" class="RktValLink" pltdoc="x">write-editor-version</a></span> and <span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._read-editor-version))" class="RktValLink" pltdoc="x">read-editor-version</a></span> before
 the header operations.</p><p>The editor file data format can be embedded within another file, and
 it can be extended with new kinds of data. The editor file format can
 be extended in two ways: with snip- or content-specific data, and
 with editor-specific global data. These are described in the
 remainder of this section.</p><h5>1.3.2.1<tt>&nbsp;</tt><a name="(part._.Encoding_.Snips)"></a>Encoding Snips</h5><p><a name="(idx._(gentag._16._(lib._scribblings/gui/gui..scrbl)))"></a><a name="(idx._(gentag._17._(lib._scribblings/gui/gui..scrbl)))"></a>The
 generalized notion of a snip allows new snip types to be defined and
 immediately used in any editor class. Also, when two applications
 support the same kinds of snips, snip data can easily be cut and
 pasted between them, and the same data files will be readable by each
 program. This interoperability is due to a consistent encoding
 mechanism that is built into the snip system.</p><p>Graceful and extensible encoding of snips requires that
 two issues are addressed:</p><ul><li><p>The encoding function for a snip can be associated with the snip
itself. To convert a snip from an encoded representation (e.g., as
bytes in a file) to a memory object, a decoding function must be
provided for each type of snip. Furthermore, a list of such decoders
must be available to the high-level decoding process. This decoding
mapping is defined by associating a <a name="(tech._snip._clas)"></a><span style="font-style: italic">snip class</span> object to
every snip. A snip class is an instance of the <span class="RktSym"><a href="snip-class_.html" class="RktValLink" pltdoc="x">snip-class%</a></span>
class.</p></li><li><p>Some editors may require additional information to be stored
about a snip; this information is orthogonal to the type-specific
information stored by the snip itself. For example, a pasteboard
needs to remember a snip&rsquo;s <a href="#(tech._location)" pltdoc="x">location</a>, while a text editor
does not need this information.  If data is being cut and pasted from
one pasteboard to another, then information about relative
<a href="#(tech._location)" pltdoc="x">location</a>s needs to be maintained, but this information
should not inhibit pasting into an editor. Extra data is associated
with a snip through <a name="(tech._editor._data)"></a><span style="font-style: italic">editor data</span> objects, which are
instances of the <span class="RktSym"><a href="editor-data_.html" class="RktValLink" pltdoc="x">editor-data%</a></span> class; decoding requires that
each editor data object has an <a name="(tech._editor._data._clas)"></a><span style="font-style: italic">editor data class</span>, which is
an instance of the <span class="RktSym"><a href="editor-data-class_.html" class="RktValLink" pltdoc="x">editor-data-class%</a></span> class.</p></li></ul><p>Snip classes, snip data, and snip data classes solve problems related
 to encoding and decoding snips. In an application that has no need
 for saving files or cut-and-paste, these issues can be safely
 ignored.</p><h5>1.3.2.1.1<tt>&nbsp;</tt><a name="(part._editorsnipclasses)"></a>Snip Classes</h5><p>Each snip can be associated to a <a href="#(tech._snip._clas)" class="techoutside" pltdoc="x"><span class="techinside">snip class</span></a>. This &ldquo;class&rdquo;
 is not a class description in the programmer&rsquo;s language; it is an
 object which provides a way to create new snips of the appropriate
 type from an encoded snip specification.</p><p>Snip class objects can be added to the eventspace-specific
 <a name="(tech._snip._class._list)"></a><span style="font-style: italic">snip class list</span>, which is returned by
 <span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._get-the-snip-class-list))" class="RktValLink" pltdoc="x">get-the-snip-class-list</a></span>. When a snip is encoded, the snip&rsquo;s
 class name is associated with the encoding; when the snip needs to be
 decoded, then the snip class list is searched by name to find the
 snip&rsquo;s class. The snip class will then provide a decoding function
 that can create a new snip from the encoding.</p><p>If a snip class&rsquo;s name is of the form
<span class="RktVal">"((lib ...) (lib ...))"</span>,
then the snip class implementation can be loaded on
 demand. The name is parsed using <span class="RktSym"><a href="../reference/Reading.html#(def._((quote._~23~25kernel)._read))" class="RktValLink" pltdoc="x">read</a></span>; if the result has the
 form <span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._lib))" class="RktStxLink" pltdoc="x">lib</a></span><span class="stt"> </span><span class="RktVar">string</span><span class="stt"> </span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._lib))" class="RktStxLink" pltdoc="x">lib</a></span><span class="stt"> </span><span class="RktVar">string</span><span class="stt"> </span><span class="RktSym"><a href="../reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="RktStxLink" pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span>, then the first
 element used with <span class="RktSym"><a href="../reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="RktValLink" pltdoc="x">dynamic-require</a></span> along with
 <span class="RktVal">'</span><span class="RktVal">snip-class</span>. If the <span class="RktSym"><a href="../reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="RktValLink" pltdoc="x">dynamic-require</a></span> result is a
 <span class="RktSym"><a href="snip-class_.html" class="RktValLink" pltdoc="x">snip-class%</a></span> object, then it is inserted into the current
 eventspace&rsquo;s snip class list, and loading or saving continues using
 the new class.</p><p>The second <span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._lib))" class="RktStxLink" pltdoc="x">lib</a></span> form in <span class="RktVal">"((lib ...) (lib ...))"</span>
 supplies a reader for a text-only version of the snip. See
 <a href="WXME_Decoding.html" class="RktModLink" pltdoc="x"><span class="RktSym">wxme</span></a> for more information.</p><p>A snip class&rsquo;s name can also be just <span class="RktVal">"(lib ...)"</span>, which is
 used like the first part of the two-<span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._lib))" class="RktStxLink" pltdoc="x">lib</a></span> form. However, this
 form provides no information for the text-only <a href="WXME_Decoding.html" class="RktModLink" pltdoc="x"><span class="RktSym">wxme</span></a>
 reader.</p><h5>1.3.2.1.2<tt>&nbsp;</tt><a name="(part._editordata)"></a>Editor Data</h5><p>While a snip belongs to an editor, the editor may store extra
 information about a snip in some specialized way. When the snip is to
 be encoded, this extra information needs to be put into an
 <a href="#(tech._editor._data)" class="techoutside" pltdoc="x"><span class="techinside">editor data</span></a> object so that the extra information can be
 encoded as well.  In a text editor, extra information can be
 associated with ranges of <a href="#(tech._item)" pltdoc="x">item</a>s, as well as snips.</p><p>Just as a snip must be associated with a snip class to be decoded (see
 <a href="#(part._editorsnipclasses)" pltdoc="x">Snip Classes</a>), an editor data object needs an <a href="#(tech._editor._data._clas)" class="techoutside" pltdoc="x"><span class="techinside">editor
data class</span></a> for decoding. Every editor data class object can be added
 to the eventspace-specific <a name="(tech._editor._data._class._list)"></a><span style="font-style: italic">editor data class list</span>, returned
 by <span class="RktSym"><a href="Editor_Functions.html#(def._((lib._mred/main..rkt)._get-the-editor-data-class-list))" class="RktValLink" pltdoc="x">get-the-editor-data-class-list</a></span>. Alternatively, like snip
 classes (see <a href="#(part._editorsnipclasses)" pltdoc="x">Snip Classes</a>), editor data class names
 can use the form <span class="RktVal">"((lib ...)<span class="hspace">&nbsp;&nbsp;</span>(lib ...))"</span>  to enable
 on-demand loading. The corresponding module should export an
 <span class="RktSym"><a href="editor-data-class_.html" class="RktValLink" pltdoc="x">editor-data-class%</a></span> object named <span class="RktVal">'</span><span class="RktVal">editor-data-class</span>.</p><p>To store and load information about a snip or region in an editor:</p><ul><li><p>derive new classes from <span class="RktSym"><a href="editor-data_.html" class="RktValLink" pltdoc="x">editor-data%</a></span> and
<span class="RktSym"><a href="editor-data-class_.html" class="RktValLink" pltdoc="x">editor-data-class%</a></span>.</p></li><li><p>derive a new class from the <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> or
<span class="RktSym"><a href="pasteboard_.html" class="RktValLink" pltdoc="x">pasteboard%</a></span> class, and override the <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._get-snip-data))" class="RktValLink" pltdoc="x">get-snip-data</a></span> and <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._set-snip-data))" class="RktValLink" pltdoc="x">set-snip-data</a></span> methods and/or the
<span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._get-region-data))" class="RktValLink" pltdoc="x">get-region-data</a></span> and <span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._set-region-data))" class="RktValLink" pltdoc="x">set-region-data</a></span>
methods.</p><p>Note: the <span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._get-region-data))" class="RktValLink" pltdoc="x">get-region-data</a></span> and <span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._set-region-data))" class="RktValLink" pltdoc="x">set-region-data</a></span> methods are called for cut-and-paste encoding, but
not for file-saving encoding; see <a href="#(part._globaleditordata)" pltdoc="x">Global Data: Headers and Footers</a> for
information on extending the file format.</p></li></ul><h5>1.3.2.2<tt>&nbsp;</tt><a name="(part._globaleditordata)"></a>Global Data: Headers and Footers</h5><p>The editor file format provides for adding extra global data in
 special header and footer sections. To save and load special header
 and/or footer records:</p><ul><li><p>Pick a name for each header/footer record. This name should not
conflict with any other header/footer record name in use, and no one
else should use these names. All names beginning with &ldquo;wx&rdquo; are
reserved for internal use. By tagging extra header and footer records
with a unique name, the file can be safely loaded under a system that
does not support the records.</p></li><li><p>Derive a new class from the <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> or
<span class="RktSym"><a href="pasteboard_.html" class="RktValLink" pltdoc="x">pasteboard%</a></span> class, and override the <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._write-headers-to-file))" class="RktValLink" pltdoc="x">write-headers-to-file</a></span>, <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._write-footers-to-file))" class="RktValLink" pltdoc="x">write-footers-to-file</a></span>,
<span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._read-header-from-file))" class="RktValLink" pltdoc="x">read-header-from-file</a></span> and/or <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._read-footer-from-file))" class="RktValLink" pltdoc="x">read-footer-from-file</a></span> methods.</p></li></ul><p>When an editor is saved, the methods <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._write-headers-to-file))" class="RktValLink" pltdoc="x">write-headers-to-file</a></span> and <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._write-footers-to-file))" class="RktValLink" pltdoc="x">write-footers-to-file</a></span>
 are invoked; at this time, the derived <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> or
 <span class="RktSym"><a href="pasteboard_.html" class="RktValLink" pltdoc="x">pasteboard%</a></span> object has a chance to save records.  To write a
 header/footer record, first invoke the <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._begin-write-header-footer-to-file))" class="RktValLink" pltdoc="x">begin-write-header-footer-to-file</a></span> method, at which point the record
 name is provided. Once the record is written, call <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._end-write-header-footer-to-file))" class="RktValLink" pltdoc="x">end-write-header-footer-to-file</a></span>.</p><p>When an editor is loaded and a header/footer record is encountered,
 the <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._read-header-from-file))" class="RktValLink" pltdoc="x">read-header-from-file</a></span> or <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._read-footer-from-file))" class="RktValLink" pltdoc="x">read-footer-from-file</a></span> method is invoked, with the record name as the
 argument.  If the name matches a known record type, then the data can
 be loaded.</p><p>See also <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._write-headers-to-file))" class="RktValLink" pltdoc="x">write-headers-to-file</a></span> and
 <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._read-header-from-file))" class="RktValLink" pltdoc="x">read-header-from-file</a></span>.</p><h5>1.3.3<tt>&nbsp;</tt><a name="(part._editoreol)"></a>End of Line Ambiguity</h5><p>Because an editor can force a line break even when there is no
 carriage return item, a <a href="#(tech._position)" pltdoc="x">position</a> alone does not always
 specify a <a href="#(tech._location)" pltdoc="x">location</a> for the caret. Consider the last
 <a href="#(tech._position)" pltdoc="x">position</a> of a line that is soft-broken (i.e., no carriage
 return is present): there is no <a href="#(tech._item)" pltdoc="x">item</a> between the last
 <a href="#(tech._item)" pltdoc="x">item</a> of the line and the first <a href="#(tech._item)" pltdoc="x">item</a> of the next
 line, so two <a href="#(tech._location)" pltdoc="x">location</a>s (one end-of-line and one
 start-of-line) map to the same <a href="#(tech._position)" pltdoc="x">position</a>.</p><p>For this reason, <a href="#(tech._position)" pltdoc="x">position</a>-setting and
 <a href="#(tech._position)" pltdoc="x">position</a>-getting methods often have an extra argument. In
 the case of a <a href="#(tech._position)" pltdoc="x">position</a>-setting method, the argument
 specifies whether the caret should be drawn at the left or right side
 of the page (in the event that the <a href="#(tech._location)" pltdoc="x">location</a> is doubly
 defined); <span class="RktVal">#t</span> means that the caret should be drawn on the
 right side. Similarly, methods which calculate a <a href="#(tech._position)" pltdoc="x">position</a>
 from a <a href="#(tech._location)" pltdoc="x">location</a> will take an extra boxed boolean; the box
 is filled with <span class="RktVal">#t</span> if the position is ambiguous and it came
 from a right-side location, or <span class="RktVal">#f</span> otherwise.</p><h5>1.3.4<tt>&nbsp;</tt><a name="(part._editorflattened)"></a>Flattened Text</h5><p>In plain text editors, there is a simple correlation between
 <a href="#(tech._position)" pltdoc="x">position</a>s and characters. In an <span class="RktSym"><a href="editor___.html" class="RktValLink" pltdoc="x">editor&lt;%&gt;</a></span> object,
 this is not true much of the time, but it is still sometimes useful
 to just &ldquo;get the text&rdquo; of an editor.</p><p>Text can be extracted from an editor in either of two forms:</p><ul><li><p><a name="(tech._simple._text)"></a><span style="font-style: italic">Simple text</span>, where there is one character per
<a href="#(tech._item)" pltdoc="x">item</a>. <a href="#(tech._item)" pltdoc="x">Item</a>s that are characters are mapped to
themselves, and all other <a href="#(tech._item)" pltdoc="x">item</a>s are mapped to a
period. Line breaks are represented by carriage-return characters
(ASCII 13).</p></li><li><p><a name="(tech._flattened._text)"></a><span style="font-style: italic">Flattened text</span>, where each <a href="#(tech._item)" pltdoc="x">item</a> can map to
an arbitrary string.  <a href="#(tech._item)" pltdoc="x">Item</a>s that are characters are still
mapped to themselves, but more complicated <a href="#(tech._item)" pltdoc="x">item</a>s can be
represented with a useful string determined by the <a href="#(tech._item)" pltdoc="x">item</a>&rsquo;s
snip. Newlines are mapped to platform-specific character sequences
(linefeed under X, carriage return under Mac OS X, and
linefeed-carriage return under Windows). This form is called
&ldquo;flattened&rdquo; because the editor&rsquo;s <a href="#(tech._item)" pltdoc="x">item</a>s have been reduced
to a linear sequence of characters.</p></li></ul><h5>1.3.5<tt>&nbsp;</tt><a name="(part._drawcaretinfo)"></a>Caret Ownership</h5><p>Within a frame, only one object can contain the keyboard focus. This
 property must be maintained when a frame contains multiple editors in
 multiple <a href="#(tech._display)" pltdoc="x">display</a>s, and when a single editor contains other
 editors as <a href="#(tech._item)" pltdoc="x">item</a>s.</p><p>When an editor has the keyboard focus, it will usually display the
 current selection or a line indicating the insertion point; the line
 is called the <a name="(tech._caret)"></a><span style="font-style: italic">caret</span>.</p><p>When an editor contains other editors, it keeps track of caret
 ownership among the contained sub-editors. When the caret is taken
 away from the main editor, it will revoke caret ownership from the
 appropriate sub-editor.</p><p>When an editor or snip is drawn, an argument to the drawing method
 specifies whether the caret should be drawn with the data. This
 argument can be any of (in increasing order):</p><ul><li><p><a name="(idx._(gentag._18._(lib._scribblings/gui/gui..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">no-caret</span>  &ndash;  The caret should not be drawn at
all.</p></li><li><p><a name="(idx._(gentag._19._(lib._scribblings/gui/gui..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">show-inactive-caret</span>  &ndash;  The caret should be drawn
as inactive; items may be identified as the local current selection,
but the keyboard focus is elsewhere.</p></li><li><p><a name="(idx._(gentag._20._(lib._scribblings/gui/gui..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">show-caret</span>  &ndash;  The caret should be drawn to show
keyboard focus ownership.</p></li></ul><p>The <span class="RktVal">'</span><span class="RktVal">show-inactive-caret</span> display mode is useful for showing
 selection ranges in text editors that do not have the focus. This
 <span class="RktVal">'</span><span class="RktVal">show-inactive-caret</span> mode is distinct from <span class="RktVal">'</span><span class="RktVal">no-caret</span>
 mode; when editors are embedded, only the locally-active editor shows
 its selection.</p><h5>1.3.6<tt>&nbsp;</tt><a name="(part._editorcutandpastetime)"></a>Cut and Paste Time Stamps</h5><p>Methods of <span class="RktSym"><a href="editor___.html" class="RktValLink" pltdoc="x">editor&lt;%&gt;</a></span> that use the clipboard  &ndash;  including
 <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._copy))" class="RktValLink" pltdoc="x">copy</a></span>, <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._cut))" class="RktValLink" pltdoc="x">cut</a></span>, <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._paste))" class="RktValLink" pltdoc="x">paste</a></span>, and <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._do-edit-operation))" class="RktValLink" pltdoc="x">do-edit-operation</a></span>  &ndash;  consume a time
 stamp argument. This time stamp is generally extracted from the
 <span class="RktSym"><a href="mouse-event_.html" class="RktValLink" pltdoc="x">mouse-event%</a></span> or <span class="RktSym"><a href="key-event_.html" class="RktValLink" pltdoc="x">key-event%</a></span> object that triggered
 the clipboard action. X uses the time stamp to synchronize clipboard
 operations among the clipboard clients.</p><p>All instances of <span class="RktSym"><a href="event_.html" class="RktValLink" pltdoc="x">event%</a></span> include a time stamp, which can be
 obtained using <span class="RktSym"><a href="event_.html#(meth._(((lib._mred/main..rkt)._event~25)._get-time-stamp))" class="RktValLink" pltdoc="x">get-time-stamp</a></span>.</p><p>If the time stamp is 0, it defaults to the current time. Using 0 as the
 time stamp almost always works fine, but it is considered bad manners
 under X.</p><h5>1.3.7<tt>&nbsp;</tt><a name="(part._editorclickback)"></a>Clickbacks</h5><p><a name="(tech._clickback)"></a><span style="font-style: italic">Clickbacks</span> in a <span class="RktSym"><a href="text_.html" class="RktValLink" pltdoc="x">text%</a></span> editor facilitate the
 creation of simple interactive objects, such as hypertext. A
 clickback is defined by associating a callback function with a range
 of <a href="#(tech._item)" pltdoc="x">item</a>s in the editor. When a user clicks on the
 <a href="#(tech._item)" pltdoc="x">item</a>s in that range, the callback function is invoked. For
 example, a hypertext clickback would associate a range to a callback
 function that changes the selection range in the editor.</p><p>By default, the callback function is invoked when the user releases
 the mouse button. The <span class="RktSym"><a href="text_.html#(meth._(((lib._mred/main..rkt)._text~25)._set-clickback))" class="RktValLink" pltdoc="x">set-clickback</a></span> method accepts
 an optional argument that causes the callback function to be invoked
 on the button press, instead. This behavior is useful, for example,
 for a clickback that creates a popup menu.</p><p>Note that there is no attempt to save clickback information when a
 file is saved, since a clickback will have an arbitrary procedure
 associated with it.</p><h5>1.3.8<tt>&nbsp;</tt><a name="(part._lockinfo)"></a>Internal Editor Locks</h5><p>Instances of <span class="RktSym"><a href="editor___.html" class="RktValLink" pltdoc="x">editor&lt;%&gt;</a></span> have three levels of internal
 locking:</p><ul><li><p>write locking  &ndash;  When an editor is internally locked for
writing, the abstract content of the editor cannot be changed (e.g.,
insertion attempts fail silently). However, snips in a text editor
can still be split and merged, and the text editor can be changed in
ways that affect the flow of lines. The
<span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._locked-for-write~3f))" class="RktValLink" pltdoc="x">locked-for-write?</a></span> method reports whether an
editor is currently locked for writing.</p></li><li><p>flow locking  &ndash;  When a text editor is internally locked for
reflowing, it is locked for writing, the snip content of the editor
cannot change, the <a href="#(tech._location)" pltdoc="x">location</a> of a snip cannot be computed if it
is not already known (see
<span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._locations-computed~3f))" class="RktValLink" pltdoc="x">locations-computed?</a></span> in <span class="RktSym"><a href="editor___.html" class="RktValLink" pltdoc="x">editor&lt;%&gt;</a></span>), and the editor cannot
be drawn to a <a href="#(tech._display)" pltdoc="x">display</a>. A request for uncomputed location
information during a flow lock produces undefined results. The
<span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._locked-for-flow~3f))" class="RktValLink" pltdoc="x">locked-for-flow?</a></span> method reports whether an
editor is currently locked for flowing.</p></li><li><p>read locking  &ndash;  When an editor is internally locked for
reading, no operations can be performed on the editor (e.g., a
request for the current selection position returns an undefined
value). This extreme state is used only during callbacks to its snips
for setting the snip&rsquo;s administrator, splitting the snip, or merging
snips.  The <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._locked-for-read~3f))" class="RktValLink" pltdoc="x">locked-for-read?</a></span>  method reports
whether an editor is currently locked for reading.</p></li></ul><p>The internal lock for an editor is <span style="font-style: italic">not</span> affected by calls to
 <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._lock))" class="RktValLink" pltdoc="x">lock</a></span>.</p><p>Methods that report <a href="#(tech._location)" pltdoc="x">location</a>-independent information about an
 editor never trigger a lock. A method that reports <a href="#(tech._location)" pltdoc="x">location</a>
 information may trigger a flow lock or write lock if the relevant
 information has not been computed since the last modification to the
 editor (see <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._locations-computed~3f))" class="RktValLink" pltdoc="x">locations-computed?</a></span> in <span class="RktSym"><a href="editor___.html" class="RktValLink" pltdoc="x">editor&lt;%&gt;</a></span>). A method
 that modifies the editor in any way, even setting the selection
 position, can trigger a read lock, flow lock, or write lock.</p><h5>1.3.9<tt>&nbsp;</tt><a name="(part._editorthreads)"></a>Editors and Threads</h5><p>An editor is not tied to any particular thread or eventspace, except
 to the degree that it is displayed in a canvas (which has an
 eventspace). Concurrent access of an editor is always safe, in the
 sense that the editor will not become corrupted. However, because
 editor access can trigger locks, and because lock-rejected operations
 tend to fail silently, concurrent access can produce unexpected
 results.</p><p>Nevertheless, the editor supports certain concurrent patterns
 reliably. One relevant pattern is updating an editor in one thread
 while the editor is displayed in a canvas that is managed by a
 different (handler) thread. To ensure that canvas refreshes are not
 performed while the editor is locked for flowing, and to ensure that
 refreshes do not prevent editor modifications, the following are
 guaranteed:</p><ul><li><p>When an editor&rsquo;s <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._refresh))" class="RktValLink" pltdoc="x">refresh</a></span> method is
called during an edit sequence (which is started by
<span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._begin-edit-sequence))" class="RktValLink" pltdoc="x">begin-edit-sequence</a></span> and ended with
<span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._end-edit-sequence))" class="RktValLink" pltdoc="x">end-edit-sequence</a></span>), the requested refresh
region is recorded, but the refresh is not performed. Instead, the
refresh is delayed until the end of the edit sequence.</p></li><li><p>Attempting to start an edit sequence while a refresh is in
progress blocks until the refresh is complete.</p></li><li><p>The <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._on-display-size-when-ready))" class="RktValLink" pltdoc="x">on-display-size-when-ready</a></span> method
calls <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._on-display-size))" class="RktValLink" pltdoc="x">on-display-size</a></span> only when the editor
is not being refreshed and only when an edit sequence is not in
progress. In the first case, the
<span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._on-display-size))" class="RktValLink" pltdoc="x">on-display-size</a></span> call is delegated to the
refreshing thread to be called after the refresh completes. In the
second case, the <span class="RktSym"><a href="editor___.html#(meth._(((lib._mred/main..rkt)._editor~3c~25~3e)._on-display-size))" class="RktValLink" pltdoc="x">on-display-size</a></span> call is
delegated to the edit-sequence thread, to be called when the edit
sequence is complete.</p></li></ul><p>Thus, disabling an <span class="RktSym"><a href="editor-canvas_.html" class="RktValLink" pltdoc="x">editor-canvas%</a></span> object (using
 <span class="RktSym"><a href="window___.html#(meth._(((lib._mred/main..rkt)._window~3c~25~3e)._enable))" class="RktValLink" pltdoc="x">enable</a></span>) is sufficient to ensure that a
 background thread can modify an editor displayed by the canvas, as
 long as all modifications are in edit sequences. The background
 modifications will impair canvas refreshes minimally and temporarily,
 and refreshes will not impair modifications in the background thread.</p><p>A second supported pattern is reading an editor in a background thread
 while the editor may be manipulated in other threads. Since no
 <a href="#(tech._location)" pltdoc="x">location</a>-independent reads introduce locks, the such reads in
 the background thread will not impair other threads. However, other
 threads may interfere with the background thread, causing it to
 receive erroneous or out-of-date content information. This one-sided
 guarantee is useful if the background thread&rsquo;s work can be discarded
 when the editor is modified.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="drawing-overview.html" title="backward to &quot;1.2 Drawing&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Overview.html" title="up to &quot;1 Overview&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="Reference.html" title="forward to &quot;2 Reference&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>