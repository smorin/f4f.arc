<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>15.3&nbsp;Wills and Executors</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="extras.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span style="font-weight: bold">Reference</span>:<span class="mywbr"> </span> Racket</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="model.html" class="tocviewlink" pltdoc="x">Language Model</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="syntax.html" class="tocviewlink" pltdoc="x">Syntactic Forms</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="data.html" class="tocviewlink" pltdoc="x">Datatypes</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="structures.html" class="tocviewlink" pltdoc="x">Structures</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="mzlib_class.html" class="tocviewlink" pltdoc="x">Classes and Objects</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="mzlib_unit.html" class="tocviewlink" pltdoc="x">Units</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="contracts.html" class="tocviewlink" pltdoc="x">Contracts</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="match.html" class="tocviewlink" pltdoc="x">Pattern Matching</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="control.html" class="tocviewlink" pltdoc="x">Control Flow</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="concurrency.html" class="tocviewlink" pltdoc="x">Concurrency</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Macros.html" class="tocviewlink" pltdoc="x">Macros</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="input-and-output.html" class="tocviewlink" pltdoc="x">Input and Output</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="security.html" class="tocviewlink" pltdoc="x">Reflection and Security</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="os.html" class="tocviewlink" pltdoc="x">Operating System</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="memory.html" class="tocviewselflink" pltdoc="x">Memory Management</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="unsafe.html" class="tocviewlink" pltdoc="x">Unsafe Operations</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="running.html" class="tocviewlink" pltdoc="x">Running Racket</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>15&nbsp;</td><td><a href="memory.html" class="tocviewlink" pltdoc="x">Memory Management</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">15.1&nbsp;</td><td><a href="weakbox.html" class="tocviewlink" pltdoc="x">Weak Boxes</a></td></tr><tr><td align="right">15.2&nbsp;</td><td><a href="ephemerons.html" class="tocviewlink" pltdoc="x">Ephemerons</a></td></tr><tr><td align="right">15.3&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Wills and Executors</a></td></tr><tr><td align="right">15.4&nbsp;</td><td><a href="garbagecollection.html" class="tocviewlink" pltdoc="x">Garbage Collection</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#(def._((quote._~23~25kernel)._make-will-executor))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/base, racket"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>will-<wbr></wbr>executor</span></span></span></a></td></tr><tr><td><a href="#(def._((quote._~23~25kernel)._will-executor~3f))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/base, racket"><span class="RktSym"><span class="RktValLink">will-<wbr></wbr>executor?</span></span></span></a></td></tr><tr><td><a href="#(def._((quote._~23~25kernel)._will-register))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/base, racket"><span class="RktSym"><span class="RktValLink">will-<wbr></wbr>register</span></span></span></a></td></tr><tr><td><a href="#(def._((quote._~23~25kernel)._will-execute))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/base, racket"><span class="RktSym"><span class="RktValLink">will-<wbr></wbr>execute</span></span></span></a></td></tr><tr><td><a href="#(def._((quote._~23~25kernel)._will-try-execute))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/base, racket"><span class="RktSym"><span class="RktValLink">will-<wbr></wbr>try-<wbr></wbr>execute</span></span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="ephemerons.html" title="backward to &quot;15.2 Ephemerons&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="memory.html" title="up to &quot;15 Memory Management&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="garbagecollection.html" title="forward to &quot;15.4 Garbage Collection&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>15.3<tt>&nbsp;</tt><a name="(part._willexecutor)"></a>Wills and Executors</h4><p>A <a name="(tech._will._executor)"></a><span style="font-style: italic">will executor</span> manages a collection of values and
associated <a name="(tech._will)"></a><span style="font-style: italic">will</span> procedures
(a.k.a. <a name="(tech._finalizer)"></a><span style="font-style: italic">finalizers</span>). The <a href="#(tech._will)" class="techoutside" pltdoc="x"><span class="techinside">will</span></a> procedure for each
value is ready to be executed when the value has been proven (by the
garbage collector) to be unreachable, except through weak references
(see <a href="weakbox.html" pltdoc="x">Weak Boxes</a>) or as the registrant for other will
executors. A <a href="#(tech._will)" class="techoutside" pltdoc="x"><span class="techinside">will</span></a> is useful for triggering clean-up actions on
data associated with an unreachable value, such as closing a port
embedded in an object when the object is no longer used.</p><p>Calling the <span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-execute))" class="RktValLink" pltdoc="x">will-execute</a></span> or <span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-try-execute))" class="RktValLink" pltdoc="x">will-try-execute</a></span>
procedure executes a will that is ready in the specified will
executor. Wills are not executed automatically, because certain
programs need control to avoid race conditions. However, a program can
create a thread whose sole job is to execute wills for a particular
executor.</p><p>If a value is registered with multiple wills (in one or multiple
executors), the wills are readied in the reverse order of
registration. Since readying a will procedure makes the value
reachable again, the will must be executed and the value must be
proven again unreachable through only weak references before another
of the wills is readied or executed.  However, wills for distinct
unreachable values are readied at the same time, regardless of whether
the values are reachable from each other.</p><p>A will executor&rsquo;s register is held non-weakly until after the
corresponding will procedure is executed. Thus, if the content value
of a weak box (see <a href="weakbox.html" pltdoc="x">Weak Boxes</a>) is registered with a will
executor, the weak box&rsquo;s content is not changed to <span class="RktVal">#f</span> until
all wills have been executed for the value and the value has been
proven again reachable through only weak references.</p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((quote._~23~25kernel)._make-will-executor))"></a><a name="(def._((quote._~23~25kernel)._make-will-executor))"></a><span title="Provided from: racket/base, racket"><span class="RktSym"><a href="#(def._((quote._~23~25kernel)._make-will-executor))" class="RktValLink" pltdoc="x">make-will-executor</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-executor~3f))" class="RktValLink" pltdoc="x">will-executor?</a></span></td></tr></table></div><div class="SIntrapara">Returns a new will executor with no managed values.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((quote._~23~25kernel)._will-executor~3f))"></a><a name="(def._((quote._~23~25kernel)._will-executor~3f))"></a><span title="Provided from: racket/base, racket"><span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-executor~3f))" class="RktValLink" pltdoc="x">will-executor?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is a will executor, <span class="RktVal">#f</span>
otherwise.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((quote._~23~25kernel)._will-register))"></a><a name="(def._((quote._~23~25kernel)._will-register))"></a><span title="Provided from: racket/base, racket"><span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-register))" class="RktValLink" pltdoc="x">will-register</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">executor</span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">executor</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-executor~3f))" class="RktValLink" pltdoc="x">will-executor?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="Function_Contracts.html#(form._((lib._racket/contract..rkt)._-~3e))" class="RktStxLink" pltdoc="x">-&gt;</a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Data-structure_Contracts.html#(form._((lib._racket/contract/private/guts..rkt)._any))" class="RktStxLink" pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">Registers the value <span class="RktVar">v</span> with the will procedure <span class="RktVar">proc</span>
in the will executor <span class="RktVar">executor</span>. When <span class="RktVar">v</span> is proven
unreachable, then the procedure <span class="RktVar">proc</span> is ready to be called
with <span class="RktVar">v</span> as its argument via <span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-execute))" class="RktValLink" pltdoc="x">will-execute</a></span> or
<span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-try-execute))" class="RktValLink" pltdoc="x">will-try-execute</a></span>.  The <span class="RktVar">proc</span> argument is strongly
referenced until the will procedure is executed.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((quote._~23~25kernel)._will-execute))"></a><a name="(def._((quote._~23~25kernel)._will-execute))"></a><span title="Provided from: racket/base, racket"><span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-execute))" class="RktValLink" pltdoc="x">will-execute</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">executor</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Data-structure_Contracts.html#(form._((lib._racket/contract/private/guts..rkt)._any))" class="RktStxLink" pltdoc="x">any</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">executor</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-executor~3f))" class="RktValLink" pltdoc="x">will-executor?</a></span></td></tr></table></div><div class="SIntrapara">Invokes the will procedure for a single &ldquo;unreachable&rdquo; value
registered with the executor <span class="RktVar">executor</span>. The values returned
by the will procedure are the result of the <span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-execute))" class="RktValLink" pltdoc="x">will-execute</a></span>
call.  If no will is ready for immediate execution,
<span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-execute))" class="RktValLink" pltdoc="x">will-execute</a></span> blocks until one is ready.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((quote._~23~25kernel)._will-try-execute))"></a><a name="(def._((quote._~23~25kernel)._will-try-execute))"></a><span title="Provided from: racket/base, racket"><span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-try-execute))" class="RktValLink" pltdoc="x">will-try-execute</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">executor</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Data-structure_Contracts.html#(form._((lib._racket/contract/private/guts..rkt)._any))" class="RktStxLink" pltdoc="x">any</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">executor</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></div><div class="SIntrapara">Like <span class="RktSym"><a href="#(def._((quote._~23~25kernel)._will-execute))" class="RktValLink" pltdoc="x">will-execute</a></span> if a will is ready for immediate
execution. Otherwise, <span class="RktVal">#f</span> is returned.</div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="ephemerons.html" title="backward to &quot;15.2 Ephemerons&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="memory.html" title="up to &quot;15 Memory Management&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="garbagecollection.html" title="forward to &quot;15.4 Garbage Collection&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>