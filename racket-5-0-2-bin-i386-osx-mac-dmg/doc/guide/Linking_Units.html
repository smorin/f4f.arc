<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>14.3&nbsp;Linking Units</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span style="font-weight: bold">Guide</span>:<span class="mywbr"> </span> Racket</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" pltdoc="x">Welcome to Racket</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="to-scheme.html" class="tocviewlink" pltdoc="x">Racket Essentials</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="datatypes.html" class="tocviewlink" pltdoc="x">Built-<wbr></wbr>In Datatypes</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="scheme-forms.html" class="tocviewlink" pltdoc="x">Expressions and Definitions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="define-struct.html" class="tocviewlink" pltdoc="x">Programmer-<wbr></wbr>Defined Datatypes</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="modules.html" class="tocviewlink" pltdoc="x">Modules</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="contracts.html" class="tocviewlink" pltdoc="x">Contracts</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="i_o.html" class="tocviewlink" pltdoc="x">Input and Output</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="regexp.html" class="tocviewlink" pltdoc="x">Regular Expressions</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="control.html" class="tocviewlink" pltdoc="x">Exceptions and Control</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="for.html" class="tocviewlink" pltdoc="x">Iterations and Comprehensions</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="match.html" class="tocviewlink" pltdoc="x">Pattern Matching</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="classes.html" class="tocviewlink" pltdoc="x">Classes and Objects</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="units.html" class="tocviewselflink" pltdoc="x">Units (Components)</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="reflection.html" class="tocviewlink" pltdoc="x">Reflection and Dynamic Evaluation</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="macros.html" class="tocviewlink" pltdoc="x">Macros</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="languages.html" class="tocviewlink" pltdoc="x">Creating Languages</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="performance.html" class="tocviewlink" pltdoc="x">Performance</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="running.html" class="tocviewlink" pltdoc="x">Running and Creating Executables</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="compile.html" class="tocviewlink" pltdoc="x">Compilation and Configuration</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="More_Libraries.html" class="tocviewlink" pltdoc="x">More Libraries</a></td></tr><tr><td align="right">22&nbsp;</td><td><a href="dialects.html" class="tocviewlink" pltdoc="x">Dialects of Racket and Scheme</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>14&nbsp;</td><td><a href="units.html" class="tocviewlink" pltdoc="x">Units (Components)</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">14.1&nbsp;</td><td><a href="Signatures_and_Units.html" class="tocviewlink" pltdoc="x">Signatures and Units</a></td></tr><tr><td align="right">14.2&nbsp;</td><td><a href="Invoking_Units.html" class="tocviewlink" pltdoc="x">Invoking Units</a></td></tr><tr><td align="right">14.3&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Linking Units</a></td></tr><tr><td align="right">14.4&nbsp;</td><td><a href="firstclassunits.html" class="tocviewlink" pltdoc="x">First-<wbr></wbr>Class Units</a></td></tr><tr><td align="right">14.5&nbsp;</td><td><a href="Whole-module_Signatures_and_Units.html" class="tocviewlink" pltdoc="x">Whole-<wbr></wbr><span class="RktSym"><span class="RktStxLink">module</span></span> Signatures and Units</a></td></tr><tr><td align="right">14.6&nbsp;</td><td><a href="Contracts_for_Units.html" class="tocviewlink" pltdoc="x">Contracts for Units</a></td></tr><tr><td align="right">14.7&nbsp;</td><td><a href="unit_versus_module.html" class="tocviewlink" pltdoc="x"><span class="RktSym"><span class="RktStxLink">unit</span></span> versus <span class="RktSym"><span class="RktStxLink">module</span></span></a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="Invoking_Units.html" title="backward to &quot;14.2 Invoking Units&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="units.html" title="up to &quot;14 Units (Components)&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="firstclassunits.html" title="forward to &quot;14.4 First-Class Units&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>14.3<tt>&nbsp;</tt><a name="(part._.Linking_.Units)"></a>Linking Units</h4><p>We can make our toy economy more efficient by having toy factories
that cooperate with stores, creating toys that do not have to be
repainted. Instead, the toys are always created using the store&rsquo;s
color, which the factory gets by importing <span class="RktSym">toy-store^</span>:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"store-specific-factory-unit.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" class="RktBlk"><tr><td><a href="Module_Syntax.html#(part._hash-lang)" class="RktModLink" pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="../reference/index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"toy-factory-sig.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/linkinference.html#(form._((lib._mzlib/unit..rkt)._define-unit))" class="RktStxLink" pltdoc="x">define-unit</a></span><span class="hspace">&nbsp;</span><span class="RktSym">store-specific-factory@</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/creatingunits.html#(form._((lib._mzlib/unit..rkt)._import))" class="RktStxLink" pltdoc="x">import</a></span><span class="hspace">&nbsp;</span><span class="RktSym">toy-store^</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/creatingunits.html#(form._((lib._mzlib/unit..rkt)._export))" class="RktStxLink" pltdoc="x">export</a></span><span class="hspace">&nbsp;</span><span class="RktSym">toy-factory^</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define-struct.html#(form._((lib._racket/private/base..rkt)._define-struct))" class="RktStxLink" pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">toy</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">toy-color</span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">store-color</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">build-toys</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/for.html#(form._((lib._racket/private/base..rkt)._for/list))" class="RktStxLink" pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-range))" class="RktValLink" pltdoc="x">in-range</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-toy</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="RktStxLink" pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">repaint</span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="hspace">&nbsp;</span><span class="RktSym">col</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/exns.html#(def._((quote._~23~25kernel)._error))" class="RktValLink" pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"cannot repaint"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="RktStxLink" pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">store-specific-factory@</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><p>To invoke <span class="RktSym">store-specific-factory@</span>, we need
<span class="RktSym">toy-store^</span> bindings to supply to the unit. But to get
<span class="RktSym">toy-store^</span> bindings by invoking <span class="RktSym">toy-store@</span>, we will
need a toy factory! The unit implementations are mutually dependent,
and we cannot invoke either before the other.</p><p>The solution is to <a name="(tech._link)"></a><span style="font-style: italic">link</span> the units together, and then we can
invoke the combined units. The <span class="RktSym"><a href="../reference/linkinference.html#(form._((lib._mzlib/unit..rkt)._define-compound-unit/infer))" class="RktStxLink" pltdoc="x">define-compound-unit/infer</a></span> form
links any number of units to form a combined unit. It can propagate
imports and exports from the linked units, and it can satisfy each
unit&rsquo;s imports using the exports of other linked units.</p><p><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"store-specific-factory-unit.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/linkinference.html#(form._((lib._mzlib/unit..rkt)._define-compound-unit/infer))" class="RktStxLink" pltdoc="x">define-compound-unit/infer</a></span><span class="hspace">&nbsp;</span><span class="RktSym">toy-store+factory@</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/creatingunits.html#(form._((lib._mzlib/unit..rkt)._import))" class="RktStxLink" pltdoc="x">import</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/creatingunits.html#(form._((lib._mzlib/unit..rkt)._export))" class="RktStxLink" pltdoc="x">export</a></span><span class="hspace">&nbsp;</span><span class="RktSym">toy-factory^</span><span class="hspace">&nbsp;</span><span class="RktSym">toy-store^</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/creatingunits.html#(form._((lib._mzlib/unit..rkt)._link))" class="RktStxLink" pltdoc="x">link</a></span><span class="hspace">&nbsp;</span><span class="RktSym">store-specific-factory@</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">toy-store@</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></p><p>The overall result above is a unit <span class="RktSym">toy-store+factory@</span> that
exports both <span class="RktSym">toy-factory^</span> and <span class="RktSym">toy-store^</span>. The
connection between <span class="RktSym">store-specific-factory@</span> and
<span class="RktSym">toy-store@</span> is inferred from the signatures that each imports
and exports.</p><p>This unit has no imports, so we can always invoke it:</p><p><table cellspacing="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/linkinference.html#(form._((lib._mzlib/unit..rkt)._define-values/invoke-unit/infer))" class="RktStxLink" pltdoc="x">define-values/invoke-unit/infer</a></span><span class="hspace">&nbsp;</span><span class="RktSym">toy-store+factory@</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">stock!</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">get-inventory</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(list <span class="stt"> </span>(toy )(toy ))</span></p></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((lib._racket/private/map..rkt)._map))" class="RktValLink" pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">toy-color</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get-inventory</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">'(green<span class="stt"> </span>green)</span></p></td></tr></table></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="Invoking_Units.html" title="backward to &quot;14.2 Invoking Units&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="units.html" title="up to &quot;14 Units (Components)&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="firstclassunits.html" title="forward to &quot;14.4 First-Class Units&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>